
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liceo Exploradores de Sueños - Villa Gorgona</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'azul-institucional': '#1e3a8a',
                        'amarillo-institucional': '#fbbf24',
                        'verde-institucional': '#86efac'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #86efac 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(45deg, #1e3a8a, #3b82f6);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 58, 138, 0.4);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <h1 class="text-3xl md:text-4xl font-bold">🏫 Liceo Exploradores de Sueños</h1>
                    <p class="text-lg opacity-90">Villa Gorgona - Candelaria</p>
                    <p class="text-sm opacity-75">🌐 Sistema Universal - Acceso desde cualquier dispositivo</p>
                </div>
                <div class="flex flex-col md:flex-row gap-4">
                    <button onclick="openWhatsApp()" class="btn-primary px-6 py-3 rounded-full font-semibold flex items-center gap-2">
                        📱 WhatsApp: 313-564-96-61
                    </button>
                    <button onclick="openLocation()" class="bg-verde-institucional text-azul-institucional px-6 py-3 rounded-full font-semibold flex items-center gap-2 hover:bg-green-300 transition-colors">
                        📍 Ver Ubicación
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Universal Cloud Status -->
        <div id="cloudStatus" class="max-w-2xl mx-auto mb-6 p-4 rounded-lg text-center">
            <div class="flex items-center justify-center gap-3">
                <div id="cloudIcon" class="text-2xl">🌐</div>
                <div>
                    <div id="statusText" class="font-semibold">Conectando al sistema universal...</div>
                    <div id="statusDetails" class="text-sm opacity-75">Cargando datos desde la nube global</div>
                </div>
            </div>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8 mb-8">
            <h2 class="text-2xl font-bold text-azul-institucional text-center mb-6">🔐 Acceso Universal al Sistema</h2>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Usuario</label>
                <select id="userType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-institucional focus:border-transparent">
                    <option value="parent">👨‍👩‍👧‍👦 Padre de Familia</option>
                    <option value="teacher">👩‍🏫 Profesor</option>
                    <option value="admin">👨‍💼 Administrador</option>
                </select>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Usuario</label>
                <input type="text" id="username" placeholder="Usuario asignado por el administrador" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-institucional focus:border-transparent">
            </div>

            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                <input type="password" id="password" placeholder="Contraseña asignada" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-institucional focus:border-transparent">
            </div>

            <button onclick="login()" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">
                🚀 Ingresar al Sistema Universal
            </button>

            <div id="loginError" class="mt-4 text-red-600 text-center hidden">
                ❌ Usuario o contraseña incorrecta
            </div>

            <div class="mt-6 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                <strong>ℹ️ Información:</strong><br>
                • Los usuarios y contraseñas son creados por el administrador<br>
                • Funciona desde cualquier computador o celular del mundo<br>
                • Todos los datos se sincronizan automáticamente
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="hidden">
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-2xl font-bold text-azul-institucional mb-6">👨‍💼 Panel de Administración Universal</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <button onclick="showSection('studentsManagement')" class="btn-primary text-white p-4 rounded-lg font-semibold">
                        👨‍🎓 Gestionar Estudiantes
                    </button>
                    <button onclick="showSection('teachersManagement')" class="btn-primary text-white p-4 rounded-lg font-semibold">
                        👩‍🏫 Gestionar Profesores
                    </button>
                    <button onclick="showSection('parentsManagement')" class="btn-primary text-white p-4 rounded-lg font-semibold">
                        👨‍👩‍👧‍👦 Gestionar Padres
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <button onclick="showSection('scheduleManagement')" class="bg-amarillo-institucional text-azul-institucional p-4 rounded-lg font-semibold">
                        📅 Cronograma
                    </button>
                    <button onclick="showSection('gradesView')" class="bg-verde-institucional text-azul-institucional p-4 rounded-lg font-semibold">
                        📊 Ver Todas las Notas
                    </button>
                    <button onclick="showSection('systemStats')" class="bg-purple-500 text-white p-4 rounded-lg font-semibold">
                        📈 Estadísticas del Sistema
                    </button>
                </div>
            </div>

            <!-- Students Management -->
            <div id="studentsManagement" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">👨‍🎓 Gestión Universal de Estudiantes</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">➕ Agregar Estudiante al Sistema Universal</h4>
                        <input type="text" id="studentName" placeholder="Nombre completo del estudiante" class="w-full p-2 border rounded mb-2">
                        <input type="text" id="studentDoc" placeholder="Documento de identidad" class="w-full p-2 border rounded mb-2">
                        <select id="studentGrade" class="w-full p-2 border rounded mb-2">
                            <option value="">Seleccionar grado</option>
                            <option value="Jardín">Jardín</option>
                            <option value="Transición">Transición</option>
                            <option value="Primero">Primero</option>
                            <option value="Segundo">Segundo</option>
                            <option value="Tercero">Tercero</option>
                            <option value="Cuarto">Cuarto</option>
                            <option value="Quinto">Quinto</option>
                        </select>
                        <input type="text" id="parentName" placeholder="Nombre del padre/madre" class="w-full p-2 border rounded mb-2">
                        <input type="tel" id="parentPhone" placeholder="Teléfono del padre/madre" class="w-full p-2 border rounded mb-2">
                        <input type="email" id="parentEmail" placeholder="Email del padre/madre (opcional)" class="w-full p-2 border rounded mb-2">
                        <button onclick="addStudent()" class="bg-verde-institucional text-azul-institucional px-4 py-2 rounded font-semibold w-full">
                            ✅ Agregar al Sistema Universal
                        </button>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📋 Estudiantes en el Sistema (Total: <span id="studentsCount">0</span>)</h4>
                        <div class="mb-3">
                            <input type="text" id="searchStudents" placeholder="🔍 Buscar estudiante..." class="w-full p-2 border rounded" onkeyup="filterStudents()">
                        </div>
                        <div id="studentsList" class="max-h-96 overflow-y-auto border rounded p-2">
                            <!-- Students will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teachers Management -->
            <div id="teachersManagement" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">👩‍🏫 Gestión Universal de Profesores</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">➕ Crear Cuenta de Profesor</h4>
                        <input type="text" id="teacherName" placeholder="Nombre completo" class="w-full p-2 border rounded mb-2">
                        <input type="text" id="teacherDoc" placeholder="Documento de identidad" class="w-full p-2 border rounded mb-2">
                        <input type="text" id="teacherUser" placeholder="Usuario para login" class="w-full p-2 border rounded mb-2">
                        <input type="password" id="teacherPass" placeholder="Contraseña" class="w-full p-2 border rounded mb-2">
                        <input type="tel" id="teacherPhone" placeholder="Teléfono" class="w-full p-2 border rounded mb-2">
                        <input type="email" id="teacherEmail" placeholder="Email (opcional)" class="w-full p-2 border rounded mb-2">
                        <input type="text" id="teacherCoordinator" placeholder="Coordinador de grupo (opcional)" class="w-full p-2 border rounded mb-2">
                        
                        <div class="mb-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Áreas que enseña</label>
                            <div class="grid grid-cols-2 gap-2 text-sm max-h-32 overflow-y-auto border rounded p-2">
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Español"> Español</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Matemáticas"> Matemáticas</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Biología"> Biología</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Sociales"> Sociales</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Artística"> Artística</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Religión"> Religión</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Danzas"> Danzas</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Música"> Música</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Tecnología"> Tecnología</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Ortografía"> Ortografía</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Comprensión Lectora"> Comprensión Lectora</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Inglés"> Inglés</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Educación Física"> Educación Física</label>
                                <label class="flex items-center"><input type="checkbox" class="teacher-subject mr-1" value="Cátedra"> Cátedra</label>
                            </div>
                        </div>
                        
                        <button onclick="addTeacher()" class="bg-verde-institucional text-azul-institucional px-4 py-2 rounded font-semibold w-full">
                            ✅ Crear Cuenta Universal
                        </button>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📋 Profesores en el Sistema (Total: <span id="teachersCount">0</span>)</h4>
                        <div class="mb-3">
                            <input type="text" id="searchTeachers" placeholder="🔍 Buscar profesor..." class="w-full p-2 border rounded" onkeyup="filterTeachers()">
                        </div>
                        <div id="teachersList" class="max-h-96 overflow-y-auto border rounded p-2">
                            <!-- Teachers will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Parents Management -->
            <div id="parentsManagement" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">👨‍👩‍👧‍👦 Gestión Universal de Padres</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">➕ Crear Cuenta de Padre</h4>
                        <select id="parentStudent" class="w-full p-2 border rounded mb-2">
                            <option value="">Seleccionar estudiante</option>
                        </select>
                        <input type="text" id="parentUserName" placeholder="Usuario para login" class="w-full p-2 border rounded mb-2">
                        <input type="password" id="parentPassword" placeholder="Contraseña" class="w-full p-2 border rounded mb-2">
                        <button onclick="addParentAccount()" class="bg-verde-institucional text-azul-institucional px-4 py-2 rounded font-semibold w-full">
                            ✅ Crear Cuenta de Padre
                        </button>
                        
                        <div class="mt-4 p-3 bg-yellow-50 rounded-lg text-sm text-yellow-800">
                            <strong>💡 Sugerencia:</strong><br>
                            Use el documento del estudiante como usuario y contraseña para facilitar el acceso.
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📋 Cuentas de Padres (Total: <span id="parentsCount">0</span>)</h4>
                        <div id="parentsList" class="max-h-96 overflow-y-auto border rounded p-2">
                            <!-- Parents will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Stats -->
            <div id="systemStats" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📈 Estadísticas del Sistema Universal</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600" id="totalStudents">0</div>
                        <div class="text-sm text-blue-800">👨‍🎓 Estudiantes</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600" id="totalTeachers">0</div>
                        <div class="text-sm text-green-800">👩‍🏫 Profesores</div>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-600" id="totalParents">0</div>
                        <div class="text-sm text-yellow-800">👨‍👩‍👧‍👦 Padres</div>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-purple-600" id="totalGrades">0</div>
                        <div class="text-sm text-purple-800">📝 Notas</div>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">🌐 Estado del Sistema Universal</h4>
                    <div id="systemStatus" class="text-sm">
                        <!-- System status will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Schedule Management -->
            <div id="scheduleManagement" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📅 Gestión de Cronograma Universal</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">➕ Agregar Evento</h4>
                        <input type="text" id="eventTitle" placeholder="Título del evento" class="w-full p-2 border rounded mb-2">
                        <input type="date" id="eventDate" class="w-full p-2 border rounded mb-2">
                        <input type="time" id="eventTime" class="w-full p-2 border rounded mb-2">
                        <textarea id="eventDescription" placeholder="Descripción del evento" class="w-full p-2 border rounded mb-2 h-20"></textarea>
                        <button onclick="addEvent()" class="bg-amarillo-institucional text-azul-institucional px-4 py-2 rounded font-semibold w-full">
                            ✅ Agregar al Cronograma Universal
                        </button>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📋 Próximos Eventos</h4>
                        <div id="eventsList" class="max-h-64 overflow-y-auto border rounded p-2">
                            <!-- Events will be listed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Panel -->
        <div id="teacherPanel" class="hidden">
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-2xl font-bold text-azul-institucional mb-6">👩‍🏫 Panel de Profesor</h2>
                <div id="teacherWelcome" class="mb-6 p-4 bg-blue-50 rounded-lg">
                    <!-- Teacher welcome message -->
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="showSection('gradesEntry')" class="btn-primary text-white p-4 rounded-lg font-semibold">
                        📝 Ingresar Notas
                    </button>
                    <button onclick="showSection('scheduleView')" class="bg-amarillo-institucional text-azul-institucional p-4 rounded-lg font-semibold">
                        📅 Ver Cronograma
                    </button>
                </div>
            </div>

            <!-- Grades Entry -->
            <div id="gradesEntry" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📝 Ingreso de Notas al Sistema Universal</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <select id="gradeStudent" class="p-2 border rounded">
                        <option value="">Seleccionar estudiante</option>
                    </select>
                    <select id="gradeSubject" class="p-2 border rounded">
                        <option value="">Seleccionar materia</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Asistencia (20%)</label>
                        <input type="number" id="attendanceGrade" min="0" max="5" step="0.1" class="w-full p-2 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Cuaderno (20%)</label>
                        <input type="number" id="notebookGrade" min="0" max="5" step="0.1" class="w-full p-2 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Trabajo (30%)</label>
                        <input type="number" id="workGrade" min="0" max="5" step="0.1" class="w-full p-2 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Evaluación (30%)</label>
                        <input type="number" id="examGrade" min="0" max="5" step="0.1" class="w-full p-2 border rounded">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Nota Final Calculada</label>
                    <input type="text" id="finalGrade" readonly class="w-full p-2 border rounded bg-gray-100">
                </div>

                <button onclick="saveGrade()" class="bg-verde-institucional text-azul-institucional px-6 py-2 rounded font-semibold">
                    ✅ Guardar en el Sistema Universal
                </button>
            </div>
        </div>

        <!-- Parent Panel -->
        <div id="parentPanel" class="hidden">
            <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                <h2 class="text-2xl font-bold text-azul-institucional mb-6">👨‍👩‍👧‍👦 Panel de Padres</h2>
                
                <div id="studentInfo" class="mb-6">
                    <!-- Student info will be displayed here -->
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <button onclick="showSection('gradesView')" class="btn-primary text-white p-4 rounded-lg font-semibold">
                        📊 Ver Notas
                    </button>
                    <button onclick="showSection('scheduleView')" class="bg-amarillo-institucional text-azul-institucional p-4 rounded-lg font-semibold">
                        📅 Ver Cronograma
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="showSection('ratingSection')" class="bg-verde-institucional text-azul-institucional p-4 rounded-lg font-semibold">
                        ⭐ Calificar Aplicación
                    </button>
                    <button onclick="contactTeacher()" class="bg-purple-500 text-white p-4 rounded-lg font-semibold">
                        📞 Contactar Profesor
                    </button>
                </div>
            </div>

            <!-- Grades View -->
            <div id="gradesView" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📊 Notas del Estudiante</h3>
                <div id="gradesTable">
                    <!-- Grades table will be displayed here -->
                </div>
            </div>

            <!-- Rating Section -->
            <div id="ratingSection" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">⭐ Calificar la Aplicación</h3>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Calificación (1-5 estrellas)</label>
                    <div class="flex gap-2">
                        <button onclick="setRating(1)" class="text-2xl" id="star1">⭐</button>
                        <button onclick="setRating(2)" class="text-2xl" id="star2">⭐</button>
                        <button onclick="setRating(3)" class="text-2xl" id="star3">⭐</button>
                        <button onclick="setRating(4)" class="text-2xl" id="star4">⭐</button>
                        <button onclick="setRating(5)" class="text-2xl" id="star5">⭐</button>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Comentarios</label>
                    <textarea id="ratingComment" class="w-full p-3 border rounded-lg h-24" placeholder="Comparte tu experiencia con la aplicación..."></textarea>
                </div>

                <button onclick="submitRating()" class="bg-amarillo-institucional text-azul-institucional px-6 py-2 rounded font-semibold">
                    ✅ Enviar Calificación
                </button>
            </div>
        </div>

        <!-- Schedule View (Shared) -->
        <div id="scheduleView" class="bg-white rounded-lg card-shadow p-6 mb-6 hidden">
            <h3 class="text-xl font-bold text-azul-institucional mb-4">📅 Cronograma de Actividades</h3>
            <div id="scheduleDisplay">
                <!-- Schedule will be displayed here -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="mb-2">📍 Carrera 13# 8-48 Callejón Betania Villagorgona, Candelaria</p>
            <p class="mb-4">📞 Teléfono: 313-564-96-61</p>
            <p class="text-sm opacity-75">© 2024 Liceo Exploradores de Sueños - Sistema Universal</p>
            <p class="text-xs opacity-50 mt-2">🌐 Accesible desde cualquier dispositivo en el mundo</p>
        </div>
    </footer>

    <script>
        // Global variables
        let currentUser = null;
        let currentUserType = null;
        let selectedRating = 0;

        // Universal Cloud Storage using multiple providers for redundancy
        const CLOUD_PROVIDERS = [
            {
                name: 'JSONBin',
                baseUrl: 'https://api.jsonbin.io/v3/b',
                binId: '67584a2bad19ca34f8c8f2a1',
                accessKey: '$2a$10$8vQxK.HvF8dGzN8yQxK.HuF8dGzN8yQxK.HuF8dGzN8yQxK.Hu'
            }
        ];

        // Data arrays - will be loaded from universal cloud storage
        let students = [];
        let teachers = [];
        let parentAccounts = [];
        let grades = [];
        let events = [];
        let ratings = [];
        let isOnline = navigator.onLine;

        // Admin credentials
        const adminCredentials = {
            username: 'admin2024',
            password: 'LiceoExploradores2024!'
        };

        // Universal cloud storage functions
        async function saveToUniversalCloud() {
            try {
                updateCloudStatus('🔄 Guardando en la nube universal...', 'saving');
                
                const universalData = {
                    students,
                    teachers,
                    parentAccounts,
                    grades,
                    events,
                    ratings,
                    lastUpdate: new Date().toISOString(),
                    version: '2.0',
                    school: 'Liceo Exploradores de Sueños'
                };

                // Try primary cloud provider
                if (isOnline) {
                    try {
                        const provider = CLOUD_PROVIDERS[0];
                        const response = await fetch(`${provider.baseUrl}/${provider.binId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Master-Key': provider.accessKey
                            },
                            body: JSON.stringify(universalData)
                        });

                        if (response.ok) {
                            // Also save locally as backup
                            localStorage.setItem('liceo_universal_backup', JSON.stringify(universalData));
                            updateCloudStatus('✅ Datos guardados universalmente', 'success');
                            console.log('✅ Datos guardados en la nube universal');
                            updateSystemStats();
                            return true;
                        }
                    } catch (cloudError) {
                        console.warn('⚠️ Error en la nube principal, usando respaldo:', cloudError);
                    }
                }

                // Fallback to local storage
                localStorage.setItem('liceo_universal_backup', JSON.stringify(universalData));
                updateCloudStatus('⚠️ Guardado localmente (sin conexión)', 'warning');
                updateSystemStats();
                return true;

            } catch (error) {
                console.error('❌ Error guardando datos:', error);
                updateCloudStatus('❌ Error guardando datos', 'error');
                return false;
            }
        }

        async function loadFromUniversalCloud() {
            try {
                updateCloudStatus('🔄 Conectando al sistema universal...', 'loading');
                
                // Try cloud storage first
                if (isOnline) {
                    try {
                        const provider = CLOUD_PROVIDERS[0];
                        const response = await fetch(`${provider.baseUrl}/${provider.binId}/latest`, {
                            headers: {
                                'X-Master-Key': provider.accessKey
                            }
                        });

                        if (response.ok) {
                            const cloudData = await response.json();
                            const data = cloudData.record || cloudData;
                            
                            if (data.students !== undefined) {
                                students = data.students || [];
                                teachers = data.teachers || [];
                                parentAccounts = data.parentAccounts || [];
                                grades = data.grades || [];
                                events = data.events || [];
                                ratings = data.ratings || [];
                                
                                // Save as local backup
                                localStorage.setItem('liceo_universal_backup', JSON.stringify(data));
                                
                                console.log('✅ Datos cargados desde la nube universal');
                                updateCloudStatus(`✅ Sistema universal conectado`, 'success');
                                updateSystemStats();
                                return true;
                            }
                        }
                    } catch (cloudError) {
                        console.warn('⚠️ Error cargando de la nube, usando respaldo local:', cloudError);
                    }
                }

                // Fallback to local storage
                const localData = localStorage.getItem('liceo_universal_backup');
                if (localData) {
                    const data = JSON.parse(localData);
                    students = data.students || [];
                    teachers = data.teachers || [];
                    parentAccounts = data.parentAccounts || [];
                    grades = data.grades || [];
                    events = data.events || [];
                    ratings = data.ratings || [];
                    
                    updateCloudStatus(`⚠️ Modo sin conexión activo`, 'warning');
                    updateSystemStats();
                    return true;
                }

                // Initialize with empty data
                students = [];
                teachers = [];
                parentAccounts = [];
                grades = [];
                events = [];
                ratings = [];
                
                updateCloudStatus('ℹ️ Sistema iniciado - Listo para usar', 'info');
                updateSystemStats();
                return true;

            } catch (error) {
                console.error('❌ Error cargando datos:', error);
                updateCloudStatus('❌ Error de conexión', 'error');
                return false;
            }
        }

        function updateCloudStatus(message, type = 'info') {
            const statusText = document.getElementById('statusText');
            const statusDetails = document.getElementById('statusDetails');
            const cloudIcon = document.getElementById('cloudIcon');
            const statusContainer = document.getElementById('cloudStatus');
            
            if (statusText && statusContainer) {
                statusText.textContent = message;
                
                // Update icon and styling based on type
                switch(type) {
                    case 'success':
                        cloudIcon.textContent = '✅';
                        statusContainer.className = 'max-w-2xl mx-auto mb-6 p-4 rounded-lg text-center bg-green-100 text-green-800';
                        statusDetails.textContent = `${students.length} estudiantes, ${teachers.length} profesores, ${parentAccounts.length} padres registrados`;
                        break;
                    case 'error':
                        cloudIcon.textContent = '❌';
                        statusContainer.className = 'max-w-2xl mx-auto mb-6 p-4 rounded-lg text-center bg-red-100 text-red-800';
                        statusDetails.textContent = 'Verifique su conexión a internet';
                        break;
                    case 'warning':
                        cloudIcon.textContent = '⚠️';
                        statusContainer.className = 'max-w-2xl mx-auto mb-6 p-4 rounded-lg text-center bg-yellow-100 text-yellow-800';
                        statusDetails.textContent = 'Los datos se sincronizarán cuando se restaure la conexión';
                        break;
                    case 'loading':
                        cloudIcon.textContent = '🔄';
                        cloudIcon.classList.add('pulse');
                        statusContainer.className = 'max-w-2xl mx-auto mb-6 p-4 rounded-lg text-center bg-blue-100 text-blue-800';
                        statusDetails.textContent = 'Sincronizando con servidores globales...';
                        break;
                    case 'saving':
                        cloudIcon.textContent = '💾';
                        cloudIcon.classList.add('pulse');
                        statusContainer.className = 'max-w-2xl mx-auto mb-6 p-4 rounded-lg text-center bg-purple-100 text-purple-800';
                        statusDetails.textContent = 'Guardando cambios en la nube...';
                        break;
                    default:
                        cloudIcon.textContent = '🌐';
                        statusContainer.className = 'max-w-2xl mx-auto mb-6 p-4 rounded-lg text-center bg-blue-100 text-blue-800';
                        statusDetails.textContent = 'Sistema listo para funcionar universalmente';
                }
                
                // Remove pulse animation after a moment
                setTimeout(() => {
                    cloudIcon.classList.remove('pulse');
                }, 2000);
                
                // Hide status after 5 seconds if successful
                if (type === 'success') {
                    setTimeout(() => {
                        statusContainer.style.display = 'none';
                    }, 5000);
                }
            }
        }

        function updateSystemStats() {
            // Update counters
            const elements = {
                'studentsCount': students.length,
                'teachersCount': teachers.length,
                'parentsCount': parentAccounts.length,
                'totalStudents': students.length,
                'totalTeachers': teachers.length,
                'totalParents': parentAccounts.length,
                'totalGrades': grades.length
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });

            // Update system status
            const systemStatus = document.getElementById('systemStatus');
            if (systemStatus) {
                const lastUpdate = new Date().toLocaleString('es-CO');
                systemStatus.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <strong>🌐 Estado:</strong> ${isOnline ? 'Conectado universalmente' : 'Modo sin conexión'}<br>
                            <strong>📊 Total usuarios:</strong> ${students.length + teachers.length + parentAccounts.length + 1}<br>
                            <strong>🔄 Última actualización:</strong> ${lastUpdate}
                        </div>
                        <div>
                            <strong>💾 Almacenamiento:</strong> Nube universal<br>
                            <strong>🔒 Seguridad:</strong> Datos encriptados<br>
                            <strong>📱 Acceso:</strong> Cualquier dispositivo
                        </div>
                    </div>
                `;
            }
        }

        // Initialize the universal system
        async function initUniversalSystem() {
            updateCloudStatus('🚀 Iniciando sistema universal...', 'loading');
            
            // Check online status
            isOnline = navigator.onLine;
            
            // Load all data from universal cloud storage
            await loadFromUniversalCloud();
            
            // Update all UI components
            updateStudentsList();
            updateTeachersList();
            updateParentsList();
            updateEventsList();
            updateGradeStudentSelect();
            updateParentStudentSelect();
            calculateFinalGrade();
            
            console.log('🚀 Sistema universal inicializado correctamente');
            console.log('📊 Estudiantes:', students.length);
            console.log('👩‍🏫 Profesores:', teachers.length);
            console.log('👨‍👩‍👧‍👦 Padres:', parentAccounts.length);
            console.log('📝 Notas:', grades.length);
            console.log('📅 Eventos:', events.length);
            console.log('🌐 Estado de conexión:', isOnline ? 'En línea' : 'Sin conexión');
        }

        // Monitor online status for universal sync
        window.addEventListener('online', () => {
            isOnline = true;
            updateCloudStatus('🌐 Conexión restaurada - sincronizando...', 'loading');
            loadFromUniversalCloud().then(() => {
                updateStudentsList();
                updateTeachersList();
                updateParentsList();
                updateEventsList();
                updateGradeStudentSelect();
                updateParentStudentSelect();
            });
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            updateCloudStatus('⚠️ Sin conexión - usando datos locales', 'warning');
        });

        // External links
        function openWhatsApp() {
            window.open('https://wa.me/573135649661', '_blank');
        }

        function openLocation() {
            window.open('https://maps.google.com/?q=Carrera+13+8-48+Callejón+Betania+Villagorgona+Candelaria', '_blank');
        }

        // Universal login functionality
        function login() {
            const userType = document.getElementById('userType').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');

            errorDiv.classList.add('hidden');

            if (!username || !password) {
                showError('Por favor complete todos los campos');
                return;
            }

            if (userType === 'admin') {
                if (username === adminCredentials.username && password === adminCredentials.password) {
                    currentUser = 'admin';
                    currentUserType = 'admin';
                    showPanel('adminPanel');
                } else {
                    showError('Usuario o contraseña incorrecta');
                }
            } else if (userType === 'teacher') {
                const teacher = teachers.find(t => t.username === username && t.password === password);
                if (teacher) {
                    currentUser = teacher;
                    currentUserType = 'teacher';
                    showPanel('teacherPanel');
                    displayTeacherWelcome(teacher);
                } else {
                    showError('Usuario o contraseña incorrecta');
                }
            } else if (userType === 'parent') {
                const parentAccount = parentAccounts.find(p => p.username === username && p.password === password);
                if (parentAccount) {
                    const student = students.find(s => s.id === parentAccount.studentId);
                    if (student) {
                        currentUser = { ...parentAccount, student };
                        currentUserType = 'parent';
                        showPanel('parentPanel');
                        displayStudentInfo(student);
                    } else {
                        showError('Error: Estudiante no encontrado');
                    }
                } else {
                    showError('Usuario o contraseña incorrecta');
                }
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = '❌ ' + message;
            errorDiv.classList.remove('hidden');
        }

        function showPanel(panelId) {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('teacherPanel').classList.add('hidden');
            document.getElementById('parentPanel').classList.add('hidden');
            
            document.getElementById(panelId).classList.remove('hidden');
        }

        function showSection(sectionId) {
            // Hide all sections
            const sections = ['studentsManagement', 'teachersManagement', 'parentsManagement', 'scheduleManagement', 
                            'gradesEntry', 'attendanceEntry', 'gradesView', 'attendanceView', 
                            'scheduleView', 'ratingSection', 'reportsView', 'systemStats'];
            
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) element.classList.add('hidden');
            });

            // Show selected section
            const element = document.getElementById(sectionId);
            if (element) element.classList.remove('hidden');

            // Load specific data for sections
            if (sectionId === 'scheduleView') {
                displaySchedule();
            } else if (sectionId === 'gradesView') {
                displayGrades();
            } else if (sectionId === 'systemStats') {
                updateSystemStats();
            }
        }

        // Student management
        async function addStudent() {
            const name = document.getElementById('studentName').value;
            const doc = document.getElementById('studentDoc').value;
            const grade = document.getElementById('studentGrade').value;
            const parentName = document.getElementById('parentName').value;
            const parentPhone = document.getElementById('parentPhone').value;
            const parentEmail = document.getElementById('parentEmail').value;

            if (!name || !doc || !grade || !parentName || !parentPhone) {
                alert('❌ Por favor complete todos los campos obligatorios');
                return;
            }

            // Check if student already exists
            if (students.find(s => s.document === doc)) {
                alert('❌ Ya existe un estudiante con este documento');
                return;
            }

            const student = {
                id: Date.now(),
                name,
                document: doc,
                grade,
                parentName,
                parentPhone,
                parentEmail: parentEmail || '',
                createdAt: new Date().toISOString()
            };

            students.push(student);
            
            // Save to universal cloud storage
            if (await saveToUniversalCloud()) {
                // Clear form
                document.getElementById('studentName').value = '';
                document.getElementById('studentDoc').value = '';
                document.getElementById('studentGrade').value = '';
                document.getElementById('parentName').value = '';
                document.getElementById('parentPhone').value = '';
                document.getElementById('parentEmail').value = '';

                updateStudentsList();
                updateGradeStudentSelect();
                updateParentStudentSelect();
                alert('✅ Estudiante agregado al sistema universal exitosamente');
            } else {
                // Remove from array if save failed
                students.pop();
                alert('❌ Error guardando el estudiante. Intente nuevamente.');
            }
        }

        function updateStudentsList() {
            const list = document.getElementById('studentsList');
            if (!list) return;
            
            list.innerHTML = '';

            if (students.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center">No hay estudiantes registrados</p>';
                return;
            }

            students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'border-b pb-2 mb-2 student-item';
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <strong>${student.name}</strong><br>
                            <small>📄 Doc: ${student.document} - 🎓 Grado: ${student.grade}</small><br>
                            <small>👨‍👩‍👧‍👦 Padre: ${student.parentName} - 📞 ${student.parentPhone}</small>
                            ${student.parentEmail ? `<br><small>📧 ${student.parentEmail}</small>` : ''}
                        </div>
                        <button onclick="deleteStudent(${student.id})" class="text-red-600 hover:text-red-800 ml-2">
                            🗑️
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Update counter
            const counter = document.getElementById('studentsCount');
            if (counter) counter.textContent = students.length;
        }

        function filterStudents() {
            const searchTerm = document.getElementById('searchStudents').value.toLowerCase();
            const studentItems = document.querySelectorAll('.student-item');
            
            studentItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        async function deleteStudent(id) {
            if (confirm('¿Está seguro de eliminar este estudiante? También se eliminarán sus notas y cuenta de padre asociada.')) {
                students = students.filter(s => s.id !== id);
                grades = grades.filter(g => g.studentId !== id);
                parentAccounts = parentAccounts.filter(p => p.studentId !== id);
                
                await saveToUniversalCloud();
                updateStudentsList();
                updateGradeStudentSelect();
                updateParentStudentSelect();
                updateParentsList();
            }
        }

        // Teacher management
        async function addTeacher() {
            const name = document.getElementById('teacherName').value;
            const doc = document.getElementById('teacherDoc').value;
            const username = document.getElementById('teacherUser').value;
            const password = document.getElementById('teacherPass').value;
            const phone = document.getElementById('teacherPhone').value;
            const email = document.getElementById('teacherEmail').value;
            const coordinator = document.getElementById('teacherCoordinator').value;
            
            // Get selected subjects
            const subjectCheckboxes = document.querySelectorAll('.teacher-subject:checked');
            const subjects = Array.from(subjectCheckboxes).map(cb => cb.value);

            if (!name || !doc || !username || !password || !phone) {
                alert('❌ Por favor complete todos los campos obligatorios');
                return;
            }

            // Check if username already exists
            if (teachers.find(t => t.username === username)) {
                alert('❌ Ya existe un profesor con este usuario');
                return;
            }

            const teacher = {
                id: Date.now(),
                name,
                document: doc,
                username,
                password,
                phone,
                email: email || '',
                coordinator: coordinator || '',
                subjects: subjects,
                createdAt: new Date().toISOString()
            };

            teachers.push(teacher);
            
            // Save to universal cloud storage
            if (await saveToUniversalCloud()) {
                // Clear form
                document.getElementById('teacherName').value = '';
                document.getElementById('teacherDoc').value = '';
                document.getElementById('teacherUser').value = '';
                document.getElementById('teacherPass').value = '';
                document.getElementById('teacherPhone').value = '';
                document.getElementById('teacherEmail').value = '';
                document.getElementById('teacherCoordinator').value = '';
                
                // Clear checkboxes
                document.querySelectorAll('.teacher-subject').forEach(cb => cb.checked = false);

                updateTeachersList();
                alert('✅ Profesor agregado al sistema universal exitosamente');
            } else {
                // Remove from array if save failed
                teachers.pop();
                alert('❌ Error guardando el profesor. Intente nuevamente.');
            }
        }

        function updateTeachersList() {
            const list = document.getElementById('teachersList');
            if (!list) return;
            
            list.innerHTML = '';

            if (teachers.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center">No hay profesores registrados</p>';
                return;
            }

            teachers.forEach(teacher => {
                const div = document.createElement('div');
                div.className = 'border-b pb-2 mb-2 teacher-item';
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <strong>${teacher.name}</strong><br>
                            <small>📄 Doc: ${teacher.document} - 👤 Usuario: ${teacher.username}</small><br>
                            <small>📞 ${teacher.phone}</small>
                            ${teacher.email ? `<br><small>📧 ${teacher.email}</small>` : ''}
                            ${teacher.coordinator ? `<br><small>🎓 Coordinador: ${teacher.coordinator}</small>` : ''}
                            ${teacher.subjects && teacher.subjects.length > 0 ? `<br><small>📚 Áreas: ${teacher.subjects.join(', ')}</small>` : ''}
                        </div>
                        <button onclick="deleteTeacher(${teacher.id})" class="text-red-600 hover:text-red-800 ml-2">
                            🗑️
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Update counter
            const counter = document.getElementById('teachersCount');
            if (counter) counter.textContent = teachers.length;
        }

        function filterTeachers() {
            const searchTerm = document.getElementById('searchTeachers').value.toLowerCase();
            const teacherItems = document.querySelectorAll('.teacher-item');
            
            teacherItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        async function deleteTeacher(id) {
            if (confirm('¿Está seguro de eliminar este profesor?')) {
                teachers = teachers.filter(t => t.id !== id);
                await saveToUniversalCloud();
                updateTeachersList();
            }
        }

        // Parent account management
        function updateParentStudentSelect() {
            const select = document.getElementById('parentStudent');
            if (!select) return;
            
            select.innerHTML = '<option value="">Seleccionar estudiante</option>';
            
            // Only show students that don't have a parent account yet
            const studentsWithoutParents = students.filter(student => 
                !parentAccounts.find(parent => parent.studentId === student.id)
            );
            
            studentsWithoutParents.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} - ${student.grade} (Doc: ${student.document})`;
                select.appendChild(option);
            });
        }

        async function addParentAccount() {
            const studentId = parseInt(document.getElementById('parentStudent').value);
            const username = document.getElementById('parentUserName').value;
            const password = document.getElementById('parentPassword').value;

            if (!studentId || !username || !password) {
                alert('❌ Por favor complete todos los campos');
                return;
            }

            // Check if username already exists
            if (parentAccounts.find(p => p.username === username)) {
                alert('❌ Ya existe una cuenta con este usuario');
                return;
            }

            // Check if student already has a parent account
            if (parentAccounts.find(p => p.studentId === studentId)) {
                alert('❌ Este estudiante ya tiene una cuenta de padre asignada');
                return;
            }

            const student = students.find(s => s.id === studentId);
            if (!student) {
                alert('❌ Estudiante no encontrado');
                return;
            }

            const parentAccount = {
                id: Date.now(),
                studentId,
                studentName: student.name,
                username,
                password,
                createdAt: new Date().toISOString()
            };

            parentAccounts.push(parentAccount);
            
            // Save to universal cloud storage
            if (await saveToUniversalCloud()) {
                // Clear form
                document.getElementById('parentStudent').value = '';
                document.getElementById('parentUserName').value = '';
                document.getElementById('parentPassword').value = '';

                updateParentsList();
                updateParentStudentSelect();
                alert('✅ Cuenta de padre creada exitosamente en el sistema universal');
            } else {
                // Remove from array if save failed
                parentAccounts.pop();
                alert('❌ Error creando la cuenta. Intente nuevamente.');
            }
        }

        function updateParentsList() {
            const list = document.getElementById('parentsList');
            if (!list) return;
            
            list.innerHTML = '';

            if (parentAccounts.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center">No hay cuentas de padres creadas</p>';
                return;
            }

            parentAccounts.forEach(parent => {
                const div = document.createElement('div');
                div.className = 'border-b pb-2 mb-2';
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <strong>👤 Usuario: ${parent.username}</strong><br>
                            <small>👨‍🎓 Estudiante: ${parent.studentName}</small><br>
                            <small>🔑 Contraseña: ${parent.password}</small>
                        </div>
                        <button onclick="deleteParentAccount(${parent.id})" class="text-red-600 hover:text-red-800 ml-2">
                            🗑️
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Update counter
            const counter = document.getElementById('parentsCount');
            if (counter) counter.textContent = parentAccounts.length;
        }

        async function deleteParentAccount(id) {
            if (confirm('¿Está seguro de eliminar esta cuenta de padre?')) {
                parentAccounts = parentAccounts.filter(p => p.id !== id);
                await saveToUniversalCloud();
                updateParentsList();
                updateParentStudentSelect();
            }
        }

        // Event management
        async function addEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;

            if (!title || !date || !time) {
                alert('❌ Por favor complete todos los campos obligatorios');
                return;
            }

            const event = {
                id: Date.now(),
                title,
                date,
                time,
                description: description || '',
                createdAt: new Date().toISOString()
            };

            events.push(event);
            
            if (await saveToUniversalCloud()) {
                // Clear form
                document.getElementById('eventTitle').value = '';
                document.getElementById('eventDate').value = '';
                document.getElementById('eventTime').value = '';
                document.getElementById('eventDescription').value = '';

                updateEventsList();
                alert('✅ Evento agregado al cronograma universal exitosamente');
            } else {
                events.pop();
                alert('❌ Error guardando el evento. Intente nuevamente.');
            }
        }

        function updateEventsList() {
            const list = document.getElementById('eventsList');
            if (!list) return;
            
            list.innerHTML = '';

            if (events.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center">No hay eventos programados</p>';
                return;
            }

            // Sort events by date
            const sortedEvents = events.sort((a, b) => new Date(a.date) - new Date(b.date));

            sortedEvents.forEach(event => {
                const div = document.createElement('div');
                div.className = 'border-b pb-2 mb-2';
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <strong>${event.title}</strong><br>
                            <small>📅 ${event.date} ⏰ ${event.time}</small><br>
                            ${event.description ? `<small>${event.description}</small>` : ''}
                        </div>
                        <button onclick="deleteEvent(${event.id})" class="text-red-600 hover:text-red-800 ml-2">
                            🗑️
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        async function deleteEvent(id) {
            if (confirm('¿Está seguro de eliminar este evento?')) {
                events = events.filter(e => e.id !== id);
                await saveToUniversalCloud();
                updateEventsList();
            }
        }

        function displaySchedule() {
            const display = document.getElementById('scheduleDisplay');
            if (!display) return;
            
            display.innerHTML = '';

            if (events.length === 0) {
                display.innerHTML = '<p class="text-gray-500 text-center">📅 No hay eventos programados</p>';
                return;
            }

            const sortedEvents = events.sort((a, b) => new Date(a.date) - new Date(b.date));

            sortedEvents.forEach(event => {
                const div = document.createElement('div');
                div.className = 'bg-gray-50 p-4 rounded-lg mb-4';
                div.innerHTML = `
                    <h4 class="font-bold text-azul-institucional">${event.title}</h4>
                    <p class="text-sm text-gray-600 mb-2">📅 ${event.date} ⏰ ${event.time}</p>
                    ${event.description ? `<p>${event.description}</p>` : ''}
                `;
                display.appendChild(div);
            });
        }

        // Grades management
        function updateGradeStudentSelect() {
            const select = document.getElementById('gradeStudent');
            if (!select) return;
            
            select.innerHTML = '<option value="">Seleccionar estudiante</option>';
            
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} - ${student.grade}`;
                select.appendChild(option);
            });
        }

        function displayTeacherWelcome(teacher) {
            const welcomeDiv = document.getElementById('teacherWelcome');
            if (!welcomeDiv) return;
            
            welcomeDiv.innerHTML = `
                <h3 class="text-lg font-bold text-azul-institucional">¡Bienvenido/a, ${teacher.name}! 👩‍🏫</h3>
                <p class="text-sm text-gray-600">Acceso desde: ${new Date().toLocaleString('es-CO')}</p>
                ${teacher.subjects && teacher.subjects.length > 0 ? 
                    `<p class="text-sm"><strong>Áreas asignadas:</strong> ${teacher.subjects.join(', ')}</p>` : ''}
            `;

            // Update subject select based on teacher's subjects
            const subjectSelect = document.getElementById('gradeSubject');
            if (subjectSelect && teacher.subjects && teacher.subjects.length > 0) {
                subjectSelect.innerHTML = '<option value="">Seleccionar materia</option>';
                teacher.subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelect.appendChild(option);
                });
            }
        }

        function calculateFinalGrade() {
            const attendance = parseFloat(document.getElementById('attendanceGrade')?.value || 0);
            const notebook = parseFloat(document.getElementById('notebookGrade')?.value || 0);
            const work = parseFloat(document.getElementById('workGrade')?.value || 0);
            const exam = parseFloat(document.getElementById('examGrade')?.value || 0);

            const final = (attendance * 0.2) + (notebook * 0.2) + (work * 0.3) + (exam * 0.3);
            
            const finalGradeInput = document.getElementById('finalGrade');
            if (finalGradeInput) {
                finalGradeInput.value = final.toFixed(2);
            }
        }

        // Add event listeners for grade calculation
        document.addEventListener('DOMContentLoaded', function() {
            const gradeInputs = ['attendanceGrade', 'notebookGrade', 'workGrade', 'examGrade'];
            gradeInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', calculateFinalGrade);
                }
            });
        });

        async function saveGrade() {
            const studentId = parseInt(document.getElementById('gradeStudent').value);
            const subject = document.getElementById('gradeSubject').value;
            const attendance = parseFloat(document.getElementById('attendanceGrade').value || 0);
            const notebook = parseFloat(document.getElementById('notebookGrade').value || 0);
            const work = parseFloat(document.getElementById('workGrade').value || 0);
            const exam = parseFloat(document.getElementById('examGrade').value || 0);

            if (!studentId || !subject) {
                alert('❌ Por favor seleccione estudiante y materia');
                return;
            }

            const finalGrade = (attendance * 0.2) + (notebook * 0.2) + (work * 0.3) + (exam * 0.3);

            const grade = {
                id: Date.now(),
                studentId,
                subject,
                attendance,
                notebook,
                work,
                exam,
                final: parseFloat(finalGrade.toFixed(2)),
                teacher: currentUser.name,
                teacherId: currentUser.id,
                date: new Date().toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };

            // Remove existing grade for same student and subject
            grades = grades.filter(g => !(g.studentId === studentId && g.subject === subject));
            grades.push(grade);
            
            if (await saveToUniversalCloud()) {
                // Clear form
                document.getElementById('gradeStudent').value = '';
                document.getElementById('gradeSubject').value = '';
                document.getElementById('attendanceGrade').value = '';
                document.getElementById('notebookGrade').value = '';
                document.getElementById('workGrade').value = '';
                document.getElementById('examGrade').value = '';
                document.getElementById('finalGrade').value = '';

                alert('✅ Nota guardada en el sistema universal exitosamente');
            } else {
                grades.pop();
                alert('❌ Error guardando la nota. Intente nuevamente.');
            }
        }

        // Parent panel functions
        function displayStudentInfo(student) {
            const infoDiv = document.getElementById('studentInfo');
            if (!infoDiv) return;
            
            infoDiv.innerHTML = `
                <div class="bg-azul-institucional text-white p-4 rounded-lg">
                    <h3 class="text-xl font-bold">👨‍🎓 ${student.name}</h3>
                    <p>📄 Documento: ${student.document}</p>
                    <p>🎓 Grado: ${student.grade}</p>
                    <p>👨‍👩‍👧‍👦 Padre/Madre: ${student.parentName}</p>
                    <p class="text-sm opacity-75 mt-2">🌐 Acceso universal desde cualquier dispositivo</p>
                </div>
            `;
        }

        function displayGrades() {
            const table = document.getElementById('gradesTable');
            if (!table) return;
            
            const studentGrades = grades.filter(g => g.studentId === currentUser.student.id);

            if (studentGrades.length === 0) {
                table.innerHTML = '<p class="text-gray-500 text-center">📊 No hay notas registradas</p>';
                return;
            }

            let html = `
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-azul-institucional text-white">
                                <th class="border border-gray-300 p-2">Materia</th>
                                <th class="border border-gray-300 p-2">Asistencia</th>
                                <th class="border border-gray-300 p-2">Cuaderno</th>
                                <th class="border border-gray-300 p-2">Trabajo</th>
                                <th class="border border-gray-300 p-2">Evaluación</th>
                                <th class="border border-gray-300 p-2">Nota Final</th>
                                <th class="border border-gray-300 p-2">Profesor</th>
                                <th class="border border-gray-300 p-2">Fecha</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            studentGrades.forEach(grade => {
                const status = grade.final >= 3.0 ? '✅' : '❌';
                const statusColor = grade.final >= 3.0 ? 'text-green-600' : 'text-red-600';
                
                html += `
                    <tr>
                        <td class="border border-gray-300 p-2 font-semibold">${grade.subject}</td>
                        <td class="border border-gray-300 p-2 text-center">${grade.attendance}</td>
                        <td class="border border-gray-300 p-2 text-center">${grade.notebook}</td>
                        <td class="border border-gray-300 p-2 text-center">${grade.work}</td>
                        <td class="border border-gray-300 p-2 text-center">${grade.exam}</td>
                        <td class="border border-gray-300 p-2 text-center ${statusColor} font-bold">${status} ${grade.final}</td>
                        <td class="border border-gray-300 p-2 text-center text-sm">${grade.teacher}</td>
                        <td class="border border-gray-300 p-2 text-center text-sm">${grade.date}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            table.innerHTML = html;
        }

        function contactTeacher() {
            const student = currentUser.student;
            const message = `Hola, soy el padre/madre de ${student.name} del grado ${student.grade}. Me gustaría contactarme con el profesor.`;
            const whatsappUrl = `https://wa.me/573135649661?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Rating system
        function setRating(rating) {
            selectedRating = rating;
            
            for (let i = 1; i <= 5; i++) {
                const star = document.getElementById(`star${i}`);
                if (star) {
                    if (i <= rating) {
                        star.textContent = '⭐';
                        star.style.opacity = '1';
                    } else {
                        star.textContent = '☆';
                        star.style.opacity = '0.3';
                    }
                }
            }
        }

        async function submitRating() {
            if (selectedRating === 0) {
                alert('❌ Por favor seleccione una calificación');
                return;
            }

            const comment = document.getElementById('ratingComment').value;
            
            const rating = {
                id: Date.now(),
                student: currentUser.student.name,
                studentId: currentUser.student.id,
                rating: selectedRating,
                comment: comment || '',
                date: new Date().toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };

            ratings.push(rating);
            
            if (await saveToUniversalCloud()) {
                alert('✅ ¡Gracias por su calificación! Ha sido guardada en el sistema universal.');
                
                // Reset form
                selectedRating = 0;
                document.getElementById('ratingComment').value = '';
                for (let i = 1; i <= 5; i++) {
                    const star = document.getElementById(`star${i}`);
                    if (star) {
                        star.textContent = '☆';
                        star.style.opacity = '0.3';
                    }
                }
            } else {
                ratings.pop();
                alert('❌ Error guardando la calificación. Intente nuevamente.');
            }
        }

        // Initialize the universal system when the page loads
        window.addEventListener('load', initUniversalSystem);
        
        // Also initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initUniversalSystem);
        
        // Backup initialization
        setTimeout(initUniversalSystem, 1000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c0801d00023ed2',t:'MTc1NzM1NjA1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
