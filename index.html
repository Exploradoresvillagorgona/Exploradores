<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liceo Exploradores de Sueños - Villa Gorgona</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, remove, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        // Configuración de Firebase (usando una base de datos demo)
        const firebaseConfig = {
            apiKey: "demo-key",
            authDomain: "liceo-exploradores.firebaseapp.com",
            databaseURL: "https://liceo-exploradores-default-rtdb.firebaseio.com/",
            projectId: "liceo-exploradores",
            storageBucket: "liceo-exploradores.appspot.com",
            messagingSenderId: "123456789",
            appId: "demo-app-id"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Hacer las funciones disponibles globalmente
        window.firebaseDB = {
            ref: ref,
            set: set,
            get: get,
            push: push,
            remove: remove,
            onValue: onValue,
            database: database
        };
        
        // Inicializar la aplicación cuando Firebase esté listo
        window.initializeApp();
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'azul-institucional': '#1e3a8a',
                        'amarillo-institucional': '#fbbf24',
                        'verde-institucional': '#86efac'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #86efac 100%);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="fixed top-4 right-4 bg-white p-3 rounded-lg shadow-lg z-50 hidden">
        <div class="flex items-center gap-2">
            <div class="loading"></div>
            <span class="text-sm">Sincronizando datos...</span>
        </div>
    </div>

    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <h1 class="text-3xl md:text-4xl font-bold">🏫 Liceo Exploradores de Sueños</h1>
                    <p class="text-lg opacity-90">Villa Gorgona - Educando con amor desde Jardín hasta 5° Primaria</p>
                    <p class="text-sm opacity-75">🌐 Datos sincronizados en tiempo real</p>
                </div>
                <div class="flex flex-col md:flex-row gap-4">
                    <button onclick="openWhatsApp()" class="btn-hover bg-green-500 hover:bg-green-600 px-6 py-3 rounded-lg font-semibold transition-all duration-300 flex items-center gap-2">
                        📱 WhatsApp
                    </button>
                    <button onclick="openLocation()" class="btn-hover bg-red-500 hover:bg-red-600 px-6 py-3 rounded-lg font-semibold transition-all duration-300 flex items-center gap-2">
                        📍 Ubicación
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Welcome Section -->
        <section id="welcome" class="fade-in bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-azul-institucional mb-4">¡Bienvenidos a nuestro portal educativo! 🌟</h2>
                <p class="text-lg text-gray-700 mb-6">Accede a toda la información académica de tu hijo de manera fácil y segura desde cualquier dispositivo</p>
                
                <!-- Contact Info -->
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-azul-institucional text-white p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-2">📞 Contacto</h3>
                        <p class="text-lg">Teléfono: 313-XXX-XXXX</p>
                    </div>
                    <div class="bg-verde-institucional text-azul-institucional p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-2">📍 Dirección</h3>
                        <p class="text-lg">Carrera 13# 8-48 Callejón Betania<br>Villagorgona, Candelaria</p>
                    </div>
                </div>

                <!-- Login Buttons -->
                <div class="grid md:grid-cols-3 gap-4">
                    <button onclick="showLogin('admin')" class="btn-hover bg-azul-institucional hover:bg-blue-800 text-white px-8 py-4 rounded-lg font-bold text-lg transition-all duration-300">
                        👨‍💼 Administrador
                    </button>
                    <button onclick="showLogin('teacher')" class="btn-hover bg-amarillo-institucional hover:bg-yellow-500 text-azul-institucional px-8 py-4 rounded-lg font-bold text-lg transition-all duration-300">
                        👩‍🏫 Profesor
                    </button>
                    <button onclick="showLogin('parent')" class="btn-hover bg-verde-institucional hover:bg-green-400 text-azul-institucional px-8 py-4 rounded-lg font-bold text-lg transition-all duration-300">
                        👨‍👩‍👧‍👦 Padres
                    </button>
                </div>
            </div>
        </section>

        <!-- Login Forms -->
        <section id="loginSection" class="hidden fade-in bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="max-w-md mx-auto">
                <h3 id="loginTitle" class="text-2xl font-bold text-azul-institucional mb-6 text-center"></h3>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2" for="username">Usuario/Documento:</label>
                        <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-azul-institucional" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 font-semibold mb-2" for="password">Contraseña:</label>
                        <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-azul-institucional" required>
                    </div>
                    <button type="submit" class="w-full bg-azul-institucional hover:bg-blue-800 text-white py-3 rounded-lg font-bold transition-all duration-300">
                        🔐 Ingresar
                    </button>
                </form>
                <button onclick="showWelcome()" class="w-full mt-4 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-all duration-300">
                    ← Volver
                </button>
                <div id="loginError" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-center">
                    ❌ Usuario o contraseña incorrecta
                </div>
            </div>
        </section>

        <!-- Admin Dashboard -->
        <section id="adminDashboard" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-azul-institucional">👨‍💼 Panel de Administración</h2>
                    <div class="flex gap-2">
                        <button onclick="syncData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            🔄 Sincronizar
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            🚪 Cerrar Sesión
                        </button>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-4 gap-4 mb-8">
                    <button onclick="showAdminSection('students')" class="btn-hover bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        👨‍🎓 Gestionar Estudiantes
                    </button>
                    <button onclick="showAdminSection('teachers')" class="btn-hover bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        👩‍🏫 Gestionar Profesores
                    </button>
                    <button onclick="showAdminSection('schedule')" class="btn-hover bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        📅 Cronograma
                    </button>
                    <button onclick="showAdminSection('ratings')" class="btn-hover bg-orange-500 hover:bg-orange-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        ⭐ Calificaciones
                    </button>
                </div>

                <div id="adminContent" class="bg-gray-50 rounded-lg p-6">
                    <p class="text-center text-gray-600">Selecciona una opción del menú superior</p>
                </div>
            </div>
        </section>

        <!-- Teacher Dashboard -->
        <section id="teacherDashboard" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-azul-institucional">👩‍🏫 Panel de Profesor</h2>
                    <div class="flex gap-2">
                        <button onclick="syncData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            🔄 Sincronizar
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            🚪 Cerrar Sesión
                        </button>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-3 gap-4 mb-8">
                    <button onclick="showTeacherSection('grades')" class="btn-hover bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        📝 Ingresar Notas
                    </button>
                    <button onclick="showTeacherSection('attendance')" class="btn-hover bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        ✅ Asistencia
                    </button>
                    <button onclick="showTeacherSection('students')" class="btn-hover bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        👥 Mis Estudiantes
                    </button>
                </div>

                <div id="teacherContent" class="bg-gray-50 rounded-lg p-6">
                    <p class="text-center text-gray-600">Selecciona una opción del menú superior</p>
                </div>
            </div>
        </section>

        <!-- Parent Dashboard -->
        <section id="parentDashboard" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-azul-institucional">👨‍👩‍👧‍👦 Portal de Padres</h2>
                    <div class="flex gap-2">
                        <button onclick="syncData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            🔄 Sincronizar
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            🚪 Cerrar Sesión
                        </button>
                    </div>
                </div>
                
                <div id="studentInfo" class="mb-8">
                    <!-- Student info will be loaded here -->
                </div>

                <div class="grid md:grid-cols-2 gap-4 mb-8">
                    <button onclick="showParentSection('grades')" class="btn-hover bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        📊 Ver Notas
                    </button>
                    <button onclick="showParentSection('attendance')" class="btn-hover bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg font-semibold transition-all duration-300">
                        📅 Ver Asistencia
                    </button>
                </div>

                <div id="parentContent" class="bg-gray-50 rounded-lg p-6">
                    <p class="text-center text-gray-600">Selecciona una opción del menú superior</p>
                </div>

                <!-- Rating Section -->
                <div class="mt-8 bg-amarillo-institucional bg-opacity-20 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-azul-institucional mb-4">⭐ Califica nuestra plataforma</h3>
                    <div class="flex gap-2 mb-4">
                        <button onclick="setRating(1)" class="rating-star text-3xl text-gray-400 hover:text-yellow-500 transition-colors duration-300">⭐</button>
                        <button onclick="setRating(2)" class="rating-star text-3xl text-gray-400 hover:text-yellow-500 transition-colors duration-300">⭐</button>
                        <button onclick="setRating(3)" class="rating-star text-3xl text-gray-400 hover:text-yellow-500 transition-colors duration-300">⭐</button>
                        <button onclick="setRating(4)" class="rating-star text-3xl text-gray-400 hover:text-yellow-500 transition-colors duration-300">⭐</button>
                        <button onclick="setRating(5)" class="rating-star text-3xl text-gray-400 hover:text-yellow-500 transition-colors duration-300">⭐</button>
                    </div>
                    <textarea id="ratingComment" placeholder="Déjanos tus comentarios..." class="w-full p-3 border border-gray-300 rounded-lg mb-4"></textarea>
                    <button onclick="submitRating()" class="bg-azul-institucional hover:bg-blue-800 text-white px-6 py-2 rounded-lg transition-all duration-300">
                        Enviar Calificación
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <h3 class="text-2xl font-bold mb-4">🏫 Liceo Exploradores de Sueños</h3>
            <p class="mb-4">Formando líderes del mañana con amor y dedicación</p>
            <p class="text-sm opacity-80">© 2024 - Todos los derechos reservados | Datos sincronizados en la nube</p>
        </div>
    </footer>

    <script>
        // Variables globales
        let currentUser = null;
        let currentUserType = null;
        let selectedRating = 0;
        let systemData = {
            students: [],
            teachers: [],
            schedule: [],
            ratings: [],
            admin: { username: 'admin2024', password: 'LES2024*' }
        };

        // Funciones de Firebase y sincronización
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        async function saveToCloud(path, data) {
            try {
                showLoading();
                if (window.firebaseDB) {
                    const dbRef = window.firebaseDB.ref(window.firebaseDB.database, path);
                    await window.firebaseDB.set(dbRef, data);
                }
                hideLoading();
                return true;
            } catch (error) {
                console.error('Error guardando en la nube:', error);
                hideLoading();
                // Fallback a localStorage
                localStorage.setItem(path, JSON.stringify(data));
                return false;
            }
        }

        async function loadFromCloud(path) {
            try {
                showLoading();
                if (window.firebaseDB) {
                    const dbRef = window.firebaseDB.ref(window.firebaseDB.database, path);
                    const snapshot = await window.firebaseDB.get(dbRef);
                    hideLoading();
                    if (snapshot.exists()) {
                        return snapshot.val();
                    }
                }
                hideLoading();
                // Fallback a localStorage
                const localData = localStorage.getItem(path);
                return localData ? JSON.parse(localData) : null;
            } catch (error) {
                console.error('Error cargando de la nube:', error);
                hideLoading();
                // Fallback a localStorage
                const localData = localStorage.getItem(path);
                return localData ? JSON.parse(localData) : null;
            }
        }

        async function syncData() {
            try {
                showLoading();
                
                // Cargar todos los datos de la nube
                const cloudStudents = await loadFromCloud('students') || [];
                const cloudTeachers = await loadFromCloud('teachers') || [];
                const cloudSchedule = await loadFromCloud('schedule') || [];
                const cloudRatings = await loadFromCloud('ratings') || [];

                // Actualizar datos locales
                systemData.students = cloudStudents;
                systemData.teachers = cloudTeachers;
                systemData.schedule = cloudSchedule;
                systemData.ratings = cloudRatings;

                // Si no hay datos iniciales, crear datos de ejemplo
                if (systemData.students.length === 0) {
                    await initializeDefaultData();
                }

                hideLoading();
                
                // Actualizar la interfaz si estamos en algún dashboard
                if (currentUserType === 'admin') {
                    // Refrescar contenido de admin si está visible
                    const adminContent = document.getElementById('adminContent');
                    if (adminContent && !adminContent.innerHTML.includes('Selecciona una opción')) {
                        // Determinar qué sección está activa y refrescarla
                        refreshCurrentAdminSection();
                    }
                } else if (currentUserType === 'teacher') {
                    refreshCurrentTeacherSection();
                } else if (currentUserType === 'parent') {
                    refreshCurrentParentSection();
                }

                console.log('✅ Datos sincronizados correctamente');
            } catch (error) {
                console.error('Error sincronizando datos:', error);
                hideLoading();
            }
        }

        async function initializeDefaultData() {
            // Datos iniciales de ejemplo
            const defaultStudent = {
                id: '1234567890',
                name: 'Ana María García',
                grade: 'Jardín',
                parent: 'Carlos García',
                coordinator: 'María López',
                grades: {
                    'Español': { asistencia: 95, cuaderno: 90, trabajo: 88, evaluacion: 92 },
                    'Matemáticas': { asistencia: 90, cuaderno: 85, trabajo: 87, evaluacion: 89 },
                    'Biología': { asistencia: 92, cuaderno: 88, trabajo: 90, evaluacion: 91 },
                    'Sociales': { asistencia: 88, cuaderno: 92, trabajo: 85, evaluacion: 87 },
                    'Artística': { asistencia: 95, cuaderno: 90, trabajo: 93, evaluacion: 94 },
                    'Religión': { asistencia: 90, cuaderno: 88, trabajo: 89, evaluacion: 90 },
                    'Danzas': { asistencia: 93, cuaderno: 91, trabajo: 92, evaluacion: 93 },
                    'Música': { asistencia: 91, cuaderno: 89, trabajo: 90, evaluacion: 92 },
                    'Tecnología': { asistencia: 87, cuaderno: 85, trabajo: 88, evaluacion: 86 },
                    'Ortografía': { asistencia: 89, cuaderno: 87, trabajo: 90, evaluacion: 88 },
                    'Comprensión Lectora': { asistencia: 92, cuaderno: 90, trabajo: 91, evaluacion: 93 },
                    'Inglés': { asistencia: 85, cuaderno: 83, trabajo: 86, evaluacion: 87 },
                    'Educación Física': { asistencia: 95, cuaderno: 90, trabajo: 92, evaluacion: 94 }
                },
                attendance: 95
            };

            const defaultTeacher = {
                id: 'teacher001',
                name: 'María López',
                password: 'teacher123',
                subjects: ['Español', 'Matemáticas'],
                coordinator: true,
                grade: 'Jardín'
            };

            const defaultActivity = {
                id: Date.now(),
                title: 'Reunión de Padres - Jardín',
                date: '2024-01-15',
                time: '14:00',
                description: 'Reunión informativa sobre el progreso académico'
            };

            // Guardar datos iniciales en la nube
            await saveToCloud('students', [defaultStudent]);
            await saveToCloud('teachers', [defaultTeacher]);
            await saveToCloud('schedule', [defaultActivity]);
            await saveToCloud('ratings', []);

            // Actualizar datos locales
            systemData.students = [defaultStudent];
            systemData.teachers = [defaultTeacher];
            systemData.schedule = [defaultActivity];
            systemData.ratings = [];
        }

        // Configurar listeners en tiempo real
        function setupRealtimeListeners() {
            if (window.firebaseDB) {
                // Listener para estudiantes
                const studentsRef = window.firebaseDB.ref(window.firebaseDB.database, 'students');
                window.firebaseDB.onValue(studentsRef, (snapshot) => {
                    if (snapshot.exists()) {
                        systemData.students = snapshot.val();
                        refreshCurrentSection();
                    }
                });

                // Listener para profesores
                const teachersRef = window.firebaseDB.ref(window.firebaseDB.database, 'teachers');
                window.firebaseDB.onValue(teachersRef, (snapshot) => {
                    if (snapshot.exists()) {
                        systemData.teachers = snapshot.val();
                        refreshCurrentSection();
                    }
                });

                // Listener para cronograma
                const scheduleRef = window.firebaseDB.ref(window.firebaseDB.database, 'schedule');
                window.firebaseDB.onValue(scheduleRef, (snapshot) => {
                    if (snapshot.exists()) {
                        systemData.schedule = snapshot.val();
                        refreshCurrentSection();
                    }
                });

                // Listener para calificaciones
                const ratingsRef = window.firebaseDB.ref(window.firebaseDB.database, 'ratings');
                window.firebaseDB.onValue(ratingsRef, (snapshot) => {
                    if (snapshot.exists()) {
                        systemData.ratings = snapshot.val();
                        refreshCurrentSection();
                    }
                });
            }
        }

        function refreshCurrentSection() {
            // Esta función se llama cuando hay cambios en tiempo real
            if (currentUserType === 'admin') {
                refreshCurrentAdminSection();
            } else if (currentUserType === 'teacher') {
                refreshCurrentTeacherSection();
            } else if (currentUserType === 'parent') {
                refreshCurrentParentSection();
            }
        }

        function refreshCurrentAdminSection() {
            // Implementar lógica para refrescar la sección actual del admin
            const adminContent = document.getElementById('adminContent');
            if (adminContent && adminContent.innerHTML.includes('Gestión de Estudiantes')) {
                showAdminSection('students');
            } else if (adminContent && adminContent.innerHTML.includes('Gestión de Profesores')) {
                showAdminSection('teachers');
            } else if (adminContent && adminContent.innerHTML.includes('Cronograma')) {
                showAdminSection('schedule');
            } else if (adminContent && adminContent.innerHTML.includes('Calificaciones de Padres')) {
                showAdminSection('ratings');
            }
        }

        function refreshCurrentTeacherSection() {
            // Implementar lógica para refrescar la sección actual del profesor
            const teacherContent = document.getElementById('teacherContent');
            if (teacherContent && teacherContent.innerHTML.includes('Ingresar Notas')) {
                showTeacherSection('grades');
            } else if (teacherContent && teacherContent.innerHTML.includes('Control de Asistencia')) {
                showTeacherSection('attendance');
            } else if (teacherContent && teacherContent.innerHTML.includes('Mis Estudiantes')) {
                showTeacherSection('students');
            }
        }

        function refreshCurrentParentSection() {
            // Implementar lógica para refrescar la sección actual del padre
            const parentContent = document.getElementById('parentContent');
            if (parentContent && parentContent.innerHTML.includes('Notas de')) {
                showParentSection('grades');
            } else if (parentContent && parentContent.innerHTML.includes('Asistencia de')) {
                showParentSection('attendance');
            }
        }

        // Funciones de navegación (sin cambios)
        function showWelcome() {
            hideAllSections();
            document.getElementById('welcome').classList.remove('hidden');
        }

        function showLogin(userType) {
            hideAllSections();
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('loginError').classList.add('hidden');
            
            const titles = {
                admin: '👨‍💼 Acceso Administrador',
                teacher: '👩‍🏫 Acceso Profesor',
                parent: '👨‍👩‍👧‍👦 Acceso Padres'
            };
            
            document.getElementById('loginTitle').textContent = titles[userType];
            document.getElementById('loginForm').dataset.userType = userType;
            
            // Limpiar formulario
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function hideAllSections() {
            const sections = ['welcome', 'loginSection', 'adminDashboard', 'teacherDashboard', 'parentDashboard'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
        }

        // Función de login (actualizada para usar datos sincronizados)
        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const userType = event.target.dataset.userType;
            
            // Sincronizar datos antes del login
            await syncData();
            
            let loginSuccess = false;
            
            if (userType === 'admin') {
                if (username === systemData.admin.username && password === systemData.admin.password) {
                    loginSuccess = true;
                    currentUser = 'admin';
                    currentUserType = 'admin';
                    showAdminDashboard();
                }
            } else if (userType === 'teacher') {
                const teacher = systemData.teachers.find(t => t.id === username && t.password === password);
                if (teacher) {
                    loginSuccess = true;
                    currentUser = teacher;
                    currentUserType = 'teacher';
                    showTeacherDashboard();
                }
            } else if (userType === 'parent') {
                const student = systemData.students.find(s => s.id === username);
                if (student && password === username) {
                    loginSuccess = true;
                    currentUser = student;
                    currentUserType = 'parent';
                    showParentDashboard();
                }
            }
            
            if (!loginSuccess) {
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        // Dashboards (sin cambios significativos)
        function showAdminDashboard() {
            hideAllSections();
            document.getElementById('adminDashboard').classList.remove('hidden');
            document.getElementById('adminContent').innerHTML = '<p class="text-center text-gray-600">Selecciona una opción del menú superior</p>';
        }

        function showTeacherDashboard() {
            hideAllSections();
            document.getElementById('teacherDashboard').classList.remove('hidden');
            document.getElementById('teacherContent').innerHTML = '<p class="text-center text-gray-600">Selecciona una opción del menú superior</p>';
        }

        function showParentDashboard() {
            hideAllSections();
            document.getElementById('parentDashboard').classList.remove('hidden');
            
            const studentInfo = document.getElementById('studentInfo');
            studentInfo.innerHTML = `
                <div class="bg-azul-institucional text-white rounded-lg p-6">
                    <h3 class="text-2xl font-bold mb-2">👨‍🎓 ${currentUser.name}</h3>
                    <p class="text-lg">Grado: ${currentUser.grade}</p>
                    <p class="text-lg">Documento: ${currentUser.id}</p>
                    <p class="text-lg">Coordinador: ${currentUser.coordinator}</p>
                </div>
            `;
            
            document.getElementById('parentContent').innerHTML = '<p class="text-center text-gray-600">Selecciona una opción del menú superior</p>';
        }

        // Funciones de gestión de datos (actualizadas para usar la nube)
        async function addStudent(event) {
            event.preventDefault();
            
            const newStudent = {
                id: document.getElementById('studentId').value,
                name: document.getElementById('studentName').value,
                grade: document.getElementById('studentGrade').value,
                parent: document.getElementById('studentParent').value,
                coordinator: document.getElementById('studentCoordinator').value || 'Sin asignar',
                grades: {},
                attendance: 100
            };
            
            // Inicializar notas en 0 para todas las materias
            const subjects = ['Español', 'Matemáticas', 'Biología', 'Sociales', 'Artística', 'Religión', 'Danzas', 'Música', 'Tecnología', 'Ortografía', 'Comprensión Lectora', 'Inglés', 'Educación Física'];
            subjects.forEach(subject => {
                newStudent.grades[subject] = { asistencia: 0, cuaderno: 0, trabajo: 0, evaluacion: 0 };
            });
            
            systemData.students.push(newStudent);
            
            // Guardar en la nube
            await saveToCloud('students', systemData.students);
            
            // Actualizar la lista
            document.getElementById('studentsList').innerHTML = generateStudentsList();
            
            // Limpiar formulario
            event.target.reset();
            
            alert('✅ Estudiante agregado exitosamente y sincronizado en la nube');
        }

        async function addTeacher(event) {
            event.preventDefault();
            
            const subjects = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                if (checkbox.value !== 'on') {
                    subjects.push(checkbox.value);
                }
            });
            
            const newTeacher = {
                id: document.getElementById('teacherId').value,
                name: document.getElementById('teacherName').value,
                password: document.getElementById('teacherPassword').value,
                email: document.getElementById('teacherEmail').value || '',
                subjects: subjects,
                coordinator: document.getElementById('isCoordinator').checked,
                grade: document.getElementById('teacherGrade').value || ''
            };
            
            systemData.teachers.push(newTeacher);
            
            // Guardar en la nube
            await saveToCloud('teachers', systemData.teachers);
            
            // Actualizar la lista
            document.getElementById('teachersList').innerHTML = generateTeachersList();
            
            // Limpiar formulario
            event.target.reset();
            
            alert('✅ Profesor agregado exitosamente y sincronizado en la nube');
        }

        async function addActivity(event) {
            event.preventDefault();
            
            const newActivity = {
                id: Date.now(),
                title: document.getElementById('activityTitle').value,
                date: document.getElementById('activityDate').value,
                time: document.getElementById('activityTime').value,
                description: document.getElementById('activityDescription').value
            };
            
            systemData.schedule.push(newActivity);
            
            // Guardar en la nube
            await saveToCloud('schedule', systemData.schedule);
            
            // Actualizar la lista
            document.getElementById('activitiesList').innerHTML = generateActivitiesList();
            
            // Limpiar formulario
            event.target.reset();
            
            alert('✅ Actividad agregada exitosamente y sincronizada en la nube');
        }

        async function removeStudent(studentId) {
            if (confirm('¿Estás seguro de que quieres eliminar este estudiante?')) {
                systemData.students = systemData.students.filter(s => s.id !== studentId);
                
                // Guardar en la nube
                await saveToCloud('students', systemData.students);
                
                document.getElementById('studentsList').innerHTML = generateStudentsList();
                alert('✅ Estudiante eliminado exitosamente y sincronizado en la nube');
            }
        }

        async function removeTeacher(teacherId) {
            if (confirm('¿Estás seguro de que quieres eliminar este profesor?')) {
                systemData.teachers = systemData.teachers.filter(t => t.id !== teacherId);
                
                // Guardar en la nube
                await saveToCloud('teachers', systemData.teachers);
                
                document.getElementById('teachersList').innerHTML = generateTeachersList();
                alert('✅ Profesor eliminado exitosamente y sincronizado en la nube');
            }
        }

        async function removeActivity(activityId) {
            if (confirm('¿Estás seguro de que quieres eliminar esta actividad?')) {
                systemData.schedule = systemData.schedule.filter(a => a.id !== activityId);
                
                // Guardar en la nube
                await saveToCloud('schedule', systemData.schedule);
                
                document.getElementById('activitiesList').innerHTML = generateActivitiesList();
                alert('✅ Actividad eliminada exitosamente y sincronizada en la nube');
            }
        }

        async function saveGrades(event) {
            event.preventDefault();
            
            const studentId = document.getElementById('gradeStudent').value;
            const subject = document.getElementById('gradeSubject').value;
            const attendance = parseInt(document.getElementById('gradeAttendance').value);
            const notebook = parseInt(document.getElementById('gradeNotebook').value);
            const work = parseInt(document.getElementById('gradeWork').value);
            const evaluation = parseInt(document.getElementById('gradeEvaluation').value);
            
            const student = systemData.students.find(s => s.id === studentId);
            if (student) {
                student.grades[subject] = {
                    asistencia: attendance,
                    cuaderno: notebook,
                    trabajo: work,
                    evaluacion: evaluation
                };
                
                // Guardar en la nube
                await saveToCloud('students', systemData.students);
                
                alert('✅ Notas guardadas exitosamente y sincronizadas en la nube');
                event.target.reset();
            }
        }

        async function submitRating() {
            if (selectedRating === 0) {
                alert('Por favor selecciona una calificación');
                return;
            }
            
            const comment = document.getElementById('ratingComment').value;
            
            const newRating = {
                rating: selectedRating,
                comment: comment,
                date: new Date().toLocaleDateString(),
                student: currentUser.name
            };
            
            systemData.ratings.push(newRating);
            
            // Guardar en la nube
            await saveToCloud('ratings', systemData.ratings);
            
            alert('✅ ¡Gracias por tu calificación! Se ha sincronizado en la nube');
            
            // Limpiar formulario
            selectedRating = 0;
            document.getElementById('ratingComment').value = '';
            document.querySelectorAll('.rating-star').forEach(star => {
                star.classList.remove('text-yellow-500');
                star.classList.add('text-gray-400');
            });
        }

        // Resto de funciones sin cambios significativos...
        // [Incluir todas las demás funciones como generateStudentsList, showAdminSection, etc.]

        // Secciones de administrador
        function showAdminSection(section) {
            const content = document.getElementById('adminContent');
            
            switch(section) {
                case 'students':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">👨‍🎓 Gestión de Estudiantes</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h4 class="text-xl font-bold mb-4">➕ Agregar Estudiante</h4>
                                <form onsubmit="addStudent(event)">
                                    <input type="text" id="studentName" placeholder="Nombre completo" class="w-full p-3 border rounded-lg mb-3" required>
                                    <input type="text" id="studentId" placeholder="Documento" class="w-full p-3 border rounded-lg mb-3" required>
                                    <select id="studentGrade" class="w-full p-3 border rounded-lg mb-3" required>
                                        <option value="">Seleccionar grado</option>
                                        <option value="Jardín">Jardín</option>
                                        <option value="Transición">Transición</option>
                                        <option value="1°">1° Primaria</option>
                                        <option value="2°">2° Primaria</option>
                                        <option value="3°">3° Primaria</option>
                                        <option value="4°">4° Primaria</option>
                                        <option value="5°">5° Primaria</option>
                                    </select>
                                    <input type="text" id="studentParent" placeholder="Nombre del padre/madre" class="w-full p-3 border rounded-lg mb-3" required>
                                    <input type="text" id="studentCoordinator" placeholder="Coordinador de grupo (opcional)" class="w-full p-3 border rounded-lg mb-3">
                                    <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-lg font-semibold">Agregar Estudiante</button>
                                </form>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h4 class="text-xl font-bold mb-4">📋 Lista de Estudiantes</h4>
                                <div id="studentsList" class="space-y-3 max-h-96 overflow-y-auto">
                                    ${generateStudentsList()}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'teachers':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">👩‍🏫 Gestión de Profesores</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h4 class="text-xl font-bold mb-4">➕ Agregar Profesor</h4>
                                <form onsubmit="addTeacher(event)">
                                    <input type="text" id="teacherName" placeholder="Nombre completo" class="w-full p-3 border rounded-lg mb-3" required>
                                    <input type="text" id="teacherId" placeholder="ID de usuario" class="w-full p-3 border rounded-lg mb-3" required>
                                    <input type="password" id="teacherPassword" placeholder="Contraseña" class="w-full p-3 border rounded-lg mb-3" required>
                                    <input type="email" id="teacherEmail" placeholder="Email (opcional)" class="w-full p-3 border rounded-lg mb-3">
                                    <select id="teacherGrade" class="w-full p-3 border rounded-lg mb-3">
                                        <option value="">Grado a cargo (opcional)</option>
                                        <option value="Jardín">Jardín</option>
                                        <option value="Transición">Transición</option>
                                        <option value="1°">1° Primaria</option>
                                        <option value="2°">2° Primaria</option>
                                        <option value="3°">3° Primaria</option>
                                        <option value="4°">4° Primaria</option>
                                        <option value="5°">5° Primaria</option>
                                    </select>
                                    <div class="mb-3">
                                        <label class="block text-gray-700 font-semibold mb-2">Materias que enseña:</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <label class="flex items-center"><input type="checkbox" value="Español" class="mr-2"> Español</label>
                                            <label class="flex items-center"><input type="checkbox" value="Matemáticas" class="mr-2"> Matemáticas</label>
                                            <label class="flex items-center"><input type="checkbox" value="Biología" class="mr-2"> Biología</label>
                                            <label class="flex items-center"><input type="checkbox" value="Sociales" class="mr-2"> Sociales</label>
                                            <label class="flex items-center"><input type="checkbox" value="Artística" class="mr-2"> Artística</label>
                                            <label class="flex items-center"><input type="checkbox" value="Religión" class="mr-2"> Religión</label>
                                            <label class="flex items-center"><input type="checkbox" value="Danzas" class="mr-2"> Danzas</label>
                                            <label class="flex items-center"><input type="checkbox" value="Música" class="mr-2"> Música</label>
                                            <label class="flex items-center"><input type="checkbox" value="Tecnología" class="mr-2"> Tecnología</label>
                                            <label class="flex items-center"><input type="checkbox" value="Ortografía" class="mr-2"> Ortografía</label>
                                            <label class="flex items-center"><input type="checkbox" value="Comprensión Lectora" class="mr-2"> Comprensión Lectora</label>
                                            <label class="flex items-center"><input type="checkbox" value="Inglés" class="mr-2"> Inglés</label>
                                            <label class="flex items-center"><input type="checkbox" value="Educación Física" class="mr-2"> Educación Física</label>
                                        </div>
                                    </div>
                                    <label class="flex items-center mb-3">
                                        <input type="checkbox" id="isCoordinator" class="mr-2"> Es coordinador de grupo
                                    </label>
                                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg font-semibold">Agregar Profesor</button>
                                </form>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h4 class="text-xl font-bold mb-4">📋 Lista de Profesores</h4>
                                <div id="teachersList" class="space-y-3 max-h-96 overflow-y-auto">
                                    ${generateTeachersList()}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'schedule':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">📅 Cronograma de Actividades</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h4 class="text-xl font-bold mb-4">➕ Agregar Actividad</h4>
                                <form onsubmit="addActivity(event)">
                                    <input type="text" id="activityTitle" placeholder="Título de la actividad" class="w-full p-3 border rounded-lg mb-3" required>
                                    <input type="date" id="activityDate" class="w-full p-3 border rounded-lg mb-3" required>
                                    <input type="time" id="activityTime" class="w-full p-3 border rounded-lg mb-3" required>
                                    <textarea id="activityDescription" placeholder="Descripción de la actividad" class="w-full p-3 border rounded-lg mb-3 h-24" required></textarea>
                                    <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg font-semibold">Agregar Actividad</button>
                                </form>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h4 class="text-xl font-bold mb-4">📋 Próximas Actividades</h4>
                                <div id="activitiesList" class="space-y-3 max-h-96 overflow-y-auto">
                                    ${generateActivitiesList()}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'ratings':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">⭐ Calificaciones de Padres</h3>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div id="ratingsList">
                                ${generateRatingsList()}
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        // Secciones de profesor
        function showTeacherSection(section) {
            const content = document.getElementById('teacherContent');
            
            switch(section) {
                case 'grades':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">📝 Ingresar Notas</h3>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <form onsubmit="saveGrades(event)">
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <select id="gradeStudent" class="p-3 border rounded-lg" required>
                                        <option value="">Seleccionar estudiante</option>
                                        ${generateStudentOptions()}
                                    </select>
                                    <select id="gradeSubject" class="p-3 border rounded-lg" required>
                                        <option value="">Seleccionar materia</option>
                                        ${generateSubjectOptions()}
                                    </select>
                                </div>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-1">Asistencia (30%)</label>
                                        <input type="number" id="gradeAttendance" min="0" max="100" class="w-full p-3 border rounded-lg" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-1">Cuaderno (20%)</label>
                                        <input type="number" id="gradeNotebook" min="0" max="100" class="w-full p-3 border rounded-lg" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-1">Trabajo (25%)</label>
                                        <input type="number" id="gradeWork" min="0" max="100" class="w-full p-3 border rounded-lg" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-1">Evaluación (25%)</label>
                                        <input type="number" id="gradeEvaluation" min="0" max="100" class="w-full p-3 border rounded-lg" required>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-lg font-semibold">Guardar Notas</button>
                            </form>
                        </div>
                    `;
                    break;
                    
                case 'attendance':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">✅ Control de Asistencia</h3>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="mb-4">
                                <input type="date" id="attendanceDate" class="p-3 border rounded-lg mr-4" value="${new Date().toISOString().split('T')[0]}">
                                <button onclick="loadAttendance()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg">Cargar Lista</button>
                            </div>
                            <div id="attendanceList">
                                ${generateAttendanceList()}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'students':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">👥 Mis Estudiantes</h3>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="grid gap-4">
                                ${generateMyStudentsList()}
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        // Secciones de padres
        function showParentSection(section) {
            const content = document.getElementById('parentContent');
            
            switch(section) {
                case 'grades':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">📊 Notas de ${currentUser.name}</h3>
                        <div class="bg-white p-6 rounded-lg shadow">
                            ${generateGradesReport()}
                        </div>
                    `;
                    break;
                    
                case 'attendance':
                    content.innerHTML = `
                        <h3 class="text-2xl font-bold text-azul-institucional mb-6">📅 Asistencia de ${currentUser.name}</h3>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="text-center">
                                <div class="text-6xl mb-4">${currentUser.attendance >= 90 ? '😊' : currentUser.attendance >= 80 ? '😐' : '😟'}</div>
                                <h4 class="text-3xl font-bold text-azul-institucional mb-2">${currentUser.attendance}%</h4>
                                <p class="text-lg text-gray-600">Asistencia general</p>
                                <div class="mt-6 p-4 ${currentUser.attendance >= 90 ? 'bg-green-100 text-green-800' : currentUser.attendance >= 80 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'} rounded-lg">
                                    ${currentUser.attendance >= 90 ? '¡Excelente asistencia! 🎉' : currentUser.attendance >= 80 ? 'Buena asistencia, puede mejorar 👍' : 'Asistencia baja, necesita mejorar ⚠️'}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        // Funciones auxiliares para generar contenido
        function generateStudentsList() {
            return systemData.students.map(student => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <p class="font-semibold">${student.name}</p>
                        <p class="text-sm text-gray-600">Grado: ${student.grade} | Doc: ${student.id}</p>
                    </div>
                    <button onclick="removeStudent('${student.id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                        🗑️ Eliminar
                    </button>
                </div>
            `).join('');
        }

        function generateTeachersList() {
            return systemData.teachers.map(teacher => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <p class="font-semibold">${teacher.name}</p>
                        <p class="text-sm text-gray-600">ID: ${teacher.id} | Materias: ${teacher.subjects.join(', ')}</p>
                    </div>
                    <button onclick="removeTeacher('${teacher.id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                        🗑️ Eliminar
                    </button>
                </div>
            `).join('');
        }

        function generateActivitiesList() {
            return systemData.schedule.map(activity => `
                <div class="p-4 bg-gray-50 rounded-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <h5 class="font-semibold text-azul-institucional">${activity.title}</h5>
                            <p class="text-sm text-gray-600">📅 ${activity.date} - ⏰ ${activity.time}</p>
                            <p class="text-sm mt-2">${activity.description}</p>
                        </div>
                        <button onclick="removeActivity(${activity.id})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                            🗑️
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function generateRatingsList() {
            if (systemData.ratings.length === 0) {
                return '<p class="text-center text-gray-600">No hay calificaciones aún</p>';
            }
            
            const avgRating = systemData.ratings.reduce((sum, r) => sum + r.rating, 0) / systemData.ratings.length;
            
            return `
                <div class="text-center mb-6">
                    <h4 class="text-2xl font-bold text-azul-institucional">Calificación Promedio: ${avgRating.toFixed(1)} ⭐</h4>
                    <p class="text-gray-600">Basado en ${systemData.ratings.length} calificaciones</p>
                </div>
                <div class="space-y-4">
                    ${systemData.ratings.map(rating => `
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center mb-2">
                                <span class="text-yellow-500">${'⭐'.repeat(rating.rating)}</span>
                                <span class="ml-2 text-sm text-gray-600">${rating.date}</span>
                            </div>
                            <p class="text-gray-700">${rating.comment}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateStudentOptions() {
            return systemData.students.map(student => 
                `<option value="${student.id}">${student.name} - ${student.grade}</option>`
            ).join('');
        }

        function generateSubjectOptions() {
            const subjects = ['Español', 'Matemáticas', 'Biología', 'Sociales', 'Artística', 'Religión', 'Danzas', 'Música', 'Tecnología', 'Ortografía', 'Comprensión Lectora', 'Inglés', 'Educación Física'];
            return subjects.map(subject => 
                `<option value="${subject}">${subject}</option>`
            ).join('');
        }

        function generateAttendanceList() {
            return systemData.students.map(student => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg mb-2">
                    <span class="font-semibold">${student.name}</span>
                    <div class="flex gap-2">
                        <label class="flex items-center">
                            <input type="radio" name="attendance_${student.id}" value="present" class="mr-2" checked>
                            ✅ Presente
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="attendance_${student.id}" value="absent" class="mr-2">
                            ❌ Ausente
                        </label>
                    </div>
                </div>
            `).join('');
        }

        function generateMyStudentsList() {
            const myStudents = systemData.students.filter(student => 
                currentUser.subjects && currentUser.subjects.length > 0
            );
            
            return myStudents.map(student => `
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h5 class="font-semibold text-azul-institucional">${student.name}</h5>
                    <p class="text-sm text-gray-600">Grado: ${student.grade} | Documento: ${student.id}</p>
                    <p class="text-sm text-gray-600">Padre/Madre: ${student.parent}</p>
                </div>
            `).join('');
        }

        function generateGradesReport() {
            const grades = currentUser.grades;
            let html = '<div class="space-y-4">';
            
            for (const [subject, scores] of Object.entries(grades)) {
                const finalGrade = (scores.asistencia * 0.3 + scores.cuaderno * 0.2 + scores.trabajo * 0.25 + scores.evaluacion * 0.25).toFixed(1);
                const gradeColor = finalGrade >= 90 ? 'text-green-600' : finalGrade >= 80 ? 'text-yellow-600' : 'text-red-600';
                
                html += `
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h5 class="font-semibold text-azul-institucional">${subject}</h5>
                            <span class="text-2xl font-bold ${gradeColor}">${finalGrade}</span>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
                            <div>Asistencia: ${scores.asistencia}</div>
                            <div>Cuaderno: ${scores.cuaderno}</div>
                            <div>Trabajo: ${scores.trabajo}</div>
                            <div>Evaluación: ${scores.evaluacion}</div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        // Sistema de calificaciones
        function setRating(stars) {
            selectedRating = stars;
            const starElements = document.querySelectorAll('.rating-star');
            starElements.forEach((star, index) => {
                if (index < stars) {
                    star.classList.remove('text-gray-400');
                    star.classList.add('text-yellow-500');
                } else {
                    star.classList.remove('text-yellow-500');
                    star.classList.add('text-gray-400');
                }
            });
        }

        // Funciones de utilidad
        function openWhatsApp() {
            window.open('https://wa.me/573130000000', '_blank');
        }

        function openLocation() {
            window.open('https://maps.google.com/?q=Carrera+13+8-48+Callejón+Betania+Villagorgona+Candelaria', '_blank');
        }

        function logout() {
            currentUser = null;
            currentUserType = null;
            showWelcome();
        }

        // Función de inicialización
        window.initializeApp = async function() {
            try {
                // Cargar datos iniciales
                await syncData();
                
                // Configurar listeners en tiempo real
                setupRealtimeListeners();
                
                // Mostrar pantalla de bienvenida
                showWelcome();
                
                console.log('✅ Aplicación inicializada correctamente con sincronización en la nube');
            } catch (error) {
                console.error('Error inicializando la aplicación:', error);
                // Fallback a funcionamiento local
                showWelcome();
            }
        };

        // Inicializar cuando el DOM esté listo (fallback si Firebase no carga)
        document.addEventListener('DOMContentLoaded', function() {
            // Si Firebase no se ha cargado en 3 segundos, inicializar sin él
            setTimeout(() => {
                if (!window.firebaseDB) {
                    console.log('Iniciando en modo local (sin sincronización en la nube)');
                    window.initializeApp();
                }
            }, 3000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97b10368636af78a',t:'MTc1NzE5MzY1Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
