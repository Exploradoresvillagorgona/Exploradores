<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liceo Exploradores de Sueños - Villa Gorgona</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'azul-institucional': '#1e3a8a',
                        'amarillo-institucional': '#fbbf24',
                        'verde-institucional': '#86efac'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #86efac 100%);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="fixed top-4 right-4 bg-white p-3 rounded-lg shadow-lg hidden">
        <div class="flex items-center gap-2">
            <div class="loading"></div>
            <span class="text-sm">Cargando datos...</span>
        </div>
    </div>

    <!-- Connection Status -->
    <div id="connectionStatus" class="fixed top-4 left-4 bg-green-100 text-green-800 p-3 rounded-lg shadow-lg">
        <div class="flex items-center gap-2">
            <span class="text-green-600">●</span>
            <span class="text-sm font-medium">Sistema funcionando correctamente</span>
        </div>
    </div>

    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <h1 class="text-3xl md:text-4xl font-bold">🏫 Liceo Exploradores de Sueños</h1>
                    <p class="text-lg mt-2">📍 Villa Gorgona - Candelaria</p>
                    <p class="text-sm mt-1">Jardín a 5° Primaria</p>
                </div>
                <div class="flex flex-col md:flex-row gap-4">
                    <a href="https://wa.me/573135649661" target="_blank" 
                       class="bg-green-500 hover:bg-green-600 px-6 py-3 rounded-lg font-semibold transition-colors flex items-center gap-2">
                        📱 WhatsApp: 313-564-96-61
                    </a>
                    <a href="https://maps.google.com/?q=Carrera+13+8-48+Callejón+Betania+Villagorgona+Candelaria" target="_blank"
                       class="bg-red-500 hover:bg-red-600 px-6 py-3 rounded-lg font-semibold transition-colors flex items-center gap-2">
                        📍 Ver Ubicación
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Login Section -->
        <div id="loginSection" class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-azul-institucional mb-6 text-center">🔐 Acceso al Sistema</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Usuario:</label>
                <select id="userType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-institucional">
                    <option value="padre">👨‍👩‍👧‍👦 Padre de Familia</option>
                    <option value="profesor">👨‍🏫 Profesor</option>
                    <option value="admin">👨‍💼 Administrador</option>
                </select>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Usuario:</label>
                <input type="text" id="username" placeholder="Documento del estudiante / Usuario" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-institucional">
            </div>

            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Contraseña:</label>
                <input type="password" id="password" placeholder="Contraseña" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-institucional">
            </div>

            <button onclick="login()" class="w-full bg-azul-institucional hover:bg-blue-800 text-white py-3 rounded-lg font-semibold transition-colors">
                🚀 Ingresar
            </button>

            <div id="loginError" class="mt-4 text-red-600 text-center hidden">
                ❌ Usuario o contraseña incorrecta
            </div>

            <!-- Demo Credentials -->
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <h3 class="font-semibold text-azul-institucional mb-2">🔑 Credenciales de Prueba:</h3>
                <div class="text-sm space-y-1">
                    <p><strong>Administrador:</strong> admin2024 / LiceoES2024!</p>
                    <p><strong>Profesor:</strong> prof001 / profesor123</p>
                    <p><strong>Padre:</strong> 12345678 / 12345678</p>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-azul-institucional mb-6">👨‍💼 Panel de Administración</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <button onclick="showSection('studentsManagement')" class="bg-amarillo-institucional hover:bg-yellow-500 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        👨‍🎓 Gestionar Estudiantes
                    </button>
                    <button onclick="showSection('teachersManagement')" class="bg-verde-institucional hover:bg-green-400 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        👨‍🏫 Gestionar Profesores
                    </button>
                    <button onclick="showSection('scheduleManagement')" class="bg-blue-200 hover:bg-blue-300 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        📅 Cronograma
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="showSection('reportsManagement')" class="bg-purple-200 hover:bg-purple-300 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        📊 Boletines y Reportes
                    </button>
                    <button onclick="exportData()" class="bg-gray-200 hover:bg-gray-300 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        💾 Exportar Datos
                    </button>
                </div>
            </div>

            <!-- Students Management -->
            <div id="studentsManagement" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">👨‍🎓 Gestión de Estudiantes</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">➕ Agregar Estudiante</h4>
                        <form id="studentForm" class="space-y-3">
                            <input type="text" id="studentName" placeholder="Nombre completo" class="w-full p-2 border rounded">
                            <input type="text" id="studentDoc" placeholder="Documento" class="w-full p-2 border rounded">
                            <select id="studentGrade" class="w-full p-2 border rounded">
                                <option value="">Seleccionar grado</option>
                                <option value="Jardín">Jardín</option>
                                <option value="Transición">Transición</option>
                                <option value="1°">1° Primaria</option>
                                <option value="2°">2° Primaria</option>
                                <option value="3°">3° Primaria</option>
                                <option value="4°">4° Primaria</option>
                                <option value="5°">5° Primaria</option>
                            </select>
                            <input type="text" id="parentName" placeholder="Nombre del padre/madre" class="w-full p-2 border rounded">
                            <input type="tel" id="parentPhone" placeholder="Teléfono del padre/madre" class="w-full p-2 border rounded">
                            <button type="button" onclick="addStudent()" class="w-full bg-azul-institucional text-white py-2 rounded hover:bg-blue-800">
                                ➕ Agregar Estudiante
                            </button>
                        </form>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📋 Lista de Estudiantes</h4>
                        <div id="studentsList" class="max-h-96 overflow-y-auto space-y-2">
                            <!-- Students will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teachers Management -->
            <div id="teachersManagement" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">👨‍🏫 Gestión de Profesores</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">➕ Agregar Profesor</h4>
                        <form id="teacherForm" class="space-y-3">
                            <input type="text" id="teacherName" placeholder="Nombre completo" class="w-full p-2 border rounded">
                            <input type="text" id="teacherDoc" placeholder="Documento" class="w-full p-2 border rounded">
                            <input type="text" id="teacherUser" placeholder="Usuario" class="w-full p-2 border rounded">
                            <input type="password" id="teacherPass" placeholder="Contraseña" class="w-full p-2 border rounded">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Áreas que enseña (opcional - seleccione múltiples):</label>
                                <div class="grid grid-cols-2 gap-2 max-h-32 overflow-y-auto border rounded p-2">
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Español" class="teacher-subject mr-1"> Español
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Matemáticas" class="teacher-subject mr-1"> Matemáticas
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Biología" class="teacher-subject mr-1"> Biología
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Sociales" class="teacher-subject mr-1"> Sociales
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Artística" class="teacher-subject mr-1"> Artística
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Religión" class="teacher-subject mr-1"> Religión
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Danzas" class="teacher-subject mr-1"> Danzas
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Música" class="teacher-subject mr-1"> Música
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Tecnología" class="teacher-subject mr-1"> Tecnología
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Ortografía" class="teacher-subject mr-1"> Ortografía
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Comprensión Lectora" class="teacher-subject mr-1"> Comprensión Lectora
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Inglés" class="teacher-subject mr-1"> Inglés
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Educación Física" class="teacher-subject mr-1"> Educación Física
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="Cátedra" class="teacher-subject mr-1"> Cátedra
                                    </label>
                                </div>
                            </div>
                            <input type="text" id="teacherCoordinator" placeholder="Coordinador de grupo (opcional)" class="w-full p-2 border rounded">
                            <button type="button" onclick="addTeacher()" class="w-full bg-azul-institucional text-white py-2 rounded hover:bg-blue-800">
                                ➕ Agregar Profesor
                            </button>
                        </form>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📋 Lista de Profesores</h4>
                        <div id="teachersList" class="max-h-96 overflow-y-auto space-y-2">
                            <!-- Teachers will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Management -->
            <div id="scheduleManagement" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📅 Gestión de Cronograma</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">➕ Agregar Evento</h4>
                        <form id="eventForm" class="space-y-3">
                            <input type="text" id="eventTitle" placeholder="Título del evento" class="w-full p-2 border rounded">
                            <textarea id="eventDescription" placeholder="Descripción" class="w-full p-2 border rounded h-20"></textarea>
                            <input type="date" id="eventDate" class="w-full p-2 border rounded">
                            <input type="time" id="eventTime" class="w-full p-2 border rounded">
                            <select id="eventType" class="w-full p-2 border rounded">
                                <option value="reunion">🤝 Reunión de Padres</option>
                                <option value="actividad">🎉 Actividad Escolar</option>
                                <option value="evaluacion">📝 Evaluación</option>
                                <option value="evento">🎊 Evento Especial</option>
                            </select>
                            <button type="button" onclick="addEvent()" class="w-full bg-azul-institucional text-white py-2 rounded hover:bg-blue-800">
                                ➕ Agregar Evento
                            </button>
                        </form>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📋 Próximos Eventos</h4>
                        <div id="eventsList" class="max-h-96 overflow-y-auto space-y-2">
                            <!-- Events will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Management -->
            <div id="reportsManagement" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📊 Boletines y Reportes</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">🔍 Buscar Estudiante</h4>
                        <input type="text" id="searchStudent" placeholder="Buscar por nombre o documento" class="w-full p-2 border rounded mb-3">
                        <button onclick="searchStudentReports()" class="w-full bg-azul-institucional text-white py-2 rounded hover:bg-blue-800">
                            🔍 Buscar
                        </button>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📈 Reportes Generales</h4>
                        <button onclick="generateGeneralReport()" class="w-full bg-verde-institucional text-azul-institucional py-2 rounded hover:bg-green-400 mb-2">
                            📊 Reporte General
                        </button>
                        <button onclick="generateAttendanceReport()" class="w-full bg-amarillo-institucional text-azul-institucional py-2 rounded hover:bg-yellow-500">
                            📅 Reporte de Asistencia
                        </button>
                    </div>
                </div>
                
                <div id="reportResults" class="mt-6">
                    <!-- Report results will appear here -->
                </div>
            </div>
        </div>

        <!-- Teacher Panel -->
        <div id="teacherPanel" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-azul-institucional mb-6">👨‍🏫 Panel de Profesor</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <button onclick="showSection('gradesEntry')" class="bg-amarillo-institucional hover:bg-yellow-500 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        📝 Ingresar Notas
                    </button>
                    <button onclick="showSection('attendanceEntry')" class="bg-verde-institucional hover:bg-green-400 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        📅 Registrar Asistencia
                    </button>
                </div>
            </div>

            <!-- Grades Entry -->
            <div id="gradesEntry" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📝 Ingreso de Notas</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">Seleccionar Estudiante y Área</h4>
                        <select id="gradeStudent" class="w-full p-2 border rounded mb-3">
                            <option value="">Seleccionar estudiante</option>
                        </select>
                        <select id="gradeSubject" class="w-full p-2 border rounded mb-3">
                            <option value="">Seleccionar área</option>
                            <option value="Español">Español</option>
                            <option value="Matemáticas">Matemáticas</option>
                            <option value="Biología">Biología</option>
                            <option value="Sociales">Sociales</option>
                            <option value="Artística">Artística</option>
                            <option value="Religión">Religión</option>
                            <option value="Danzas">Danzas</option>
                            <option value="Música">Música</option>
                            <option value="Tecnología">Tecnología</option>
                            <option value="Ortografía">Ortografía</option>
                            <option value="Comprensión Lectora">Comprensión Lectora</option>
                            <option value="Inglés">Inglés</option>
                            <option value="Educación Física">Educación Física</option>
                            <option value="Cátedra">Cátedra</option>
                        </select>
                        
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium mb-1">Asistencia (30%)</label>
                                <input type="number" id="attendanceGrade" min="0" max="5" step="0.1" class="w-full p-2 border rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Entrega de Cuaderno (20%)</label>
                                <input type="number" id="notebookGrade" min="0" max="5" step="0.1" class="w-full p-2 border rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Trabajo (25%)</label>
                                <input type="number" id="workGrade" min="0" max="5" step="0.1" class="w-full p-2 border rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Evaluación (25%)</label>
                                <input type="number" id="examGrade" min="0" max="5" step="0.1" class="w-full p-2 border rounded">
                            </div>
                        </div>
                        
                        <button onclick="saveGrades()" class="w-full bg-azul-institucional text-white py-2 rounded hover:bg-blue-800 mt-4">
                            💾 Guardar Notas
                        </button>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">📊 Cálculo Automático</h4>
                        <div id="gradeCalculation" class="bg-gray-50 p-4 rounded">
                            <p class="text-sm text-gray-600 mb-2">La nota final se calcula automáticamente:</p>
                            <ul class="text-sm space-y-1">
                                <li>• Asistencia: 30%</li>
                                <li>• Cuaderno: 20%</li>
                                <li>• Trabajo: 25%</li>
                                <li>• Evaluación: 25%</li>
                            </ul>
                            <div id="finalGrade" class="mt-4 p-3 bg-azul-institucional text-white rounded text-center font-bold">
                                Nota Final: --
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Attendance Entry -->
            <div id="attendanceEntry" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📅 Registro de Asistencia</h3>
                
                <div class="mb-4">
                    <input type="date" id="attendanceDate" class="p-2 border rounded mr-4">
                    <button onclick="loadAttendanceList()" class="bg-azul-institucional text-white py-2 px-4 rounded hover:bg-blue-800">
                        📋 Cargar Lista
                    </button>
                </div>
                
                <div id="attendanceList" class="space-y-2">
                    <!-- Attendance list will appear here -->
                </div>
                
                <button onclick="saveAttendance()" class="w-full bg-verde-institucional text-azul-institucional py-2 rounded hover:bg-green-400 mt-4">
                    💾 Guardar Asistencia
                </button>
            </div>
        </div>

        <!-- Parent Panel -->
        <div id="parentPanel" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-azul-institucional mb-6">👨‍👩‍👧‍👦 Panel de Padres</h2>
                
                <div id="studentInfo" class="mb-6">
                    <!-- Student info will be displayed here -->
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <button onclick="showSection('studentGrades')" class="bg-amarillo-institucional hover:bg-yellow-500 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        📊 Ver Notas
                    </button>
                    <button onclick="showSection('studentAttendance')" class="bg-verde-institucional hover:bg-green-400 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        📅 Ver Asistencia
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="showSection('schoolSchedule')" class="bg-blue-200 hover:bg-blue-300 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        📅 Cronograma Escolar
                    </button>
                    <button onclick="showSection('rateApp')" class="bg-purple-200 hover:bg-purple-300 text-azul-institucional py-3 px-6 rounded-lg font-semibold transition-colors">
                        ⭐ Calificar App
                    </button>
                </div>
            </div>

            <!-- Student Grades -->
            <div id="studentGrades" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📊 Notas del Estudiante</h3>
                <div id="gradesDisplay">
                    <!-- Grades will be displayed here -->
                </div>
            </div>

            <!-- Student Attendance -->
            <div id="studentAttendance" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📅 Asistencia del Estudiante</h3>
                <div id="attendanceDisplay">
                    <!-- Attendance will be displayed here -->
                </div>
            </div>

            <!-- School Schedule -->
            <div id="schoolSchedule" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">📅 Cronograma Escolar</h3>
                <div id="scheduleDisplay">
                    <!-- Schedule will be displayed here -->
                </div>
            </div>

            <!-- Rate App -->
            <div id="rateApp" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold text-azul-institucional mb-4">⭐ Calificar la Aplicación</h3>
                
                <div class="text-center mb-6">
                    <p class="mb-4">¿Qué te parece nuestra plataforma educativa?</p>
                    <div class="flex justify-center space-x-2 mb-4">
                        <button onclick="setRating(1)" class="text-3xl hover:scale-110 transition-transform" id="star1">⭐</button>
                        <button onclick="setRating(2)" class="text-3xl hover:scale-110 transition-transform" id="star2">⭐</button>
                        <button onclick="setRating(3)" class="text-3xl hover:scale-110 transition-transform" id="star3">⭐</button>
                        <button onclick="setRating(4)" class="text-3xl hover:scale-110 transition-transform" id="star4">⭐</button>
                        <button onclick="setRating(5)" class="text-3xl hover:scale-110 transition-transform" id="star5">⭐</button>
                    </div>
                    <textarea id="ratingComment" placeholder="Déjanos tus comentarios (opcional)" class="w-full p-3 border rounded mb-4"></textarea>
                    <button onclick="submitRating()" class="bg-azul-institucional text-white py-2 px-6 rounded hover:bg-blue-800">
                        📝 Enviar Calificación
                    </button>
                </div>
                
                <div id="ratingsDisplay" class="mt-6">
                    <h4 class="font-semibold mb-3">📊 Calificaciones Recientes</h4>
                    <div id="ratingsList">
                        <!-- Ratings will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Logout Button -->
        <div id="logoutSection" class="text-center mt-8 hidden">
            <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white py-2 px-6 rounded-lg font-semibold transition-colors">
                🚪 Cerrar Sesión
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-lg font-semibold">🏫 Liceo Exploradores de Sueños</p>
            <p class="mt-2">📍 Carrera 13# 8-48 Callejón Betania Villagorgona, Candelaria</p>
            <p class="mt-1">📱 WhatsApp: 313-564-96-61</p>
            <p class="mt-4 text-sm">© 2024 - Formando el futuro de nuestros niños 🌟</p>
        </div>
    </footer>

    <script>
        // Global variables
        let currentUser = null;
        let currentUserType = null;
        let selectedRating = 0;

        // Local storage system - works completely offline
        let localCache = {
            students: [],
            teachers: [],
            grades: {},
            attendance: {},
            events: [],
            ratings: []
        };

        // Admin credentials
        const adminCredentials = { username: 'admin2024', password: 'LiceoES2024!' };

        // Initialize with demo data
        function initializeDemoData() {
            // Demo student
            const demoStudent = {
                id: 'demo_student_1',
                name: 'María Fernanda González',
                document: '12345678',
                grade: '3°',
                parentName: 'Ana González',
                parentPhone: '3001234567',
                createdAt: new Date().toISOString()
            };

            // Demo teacher
            const demoTeacher = {
                id: 'demo_teacher_1',
                name: 'Carlos Rodríguez',
                document: '87654321',
                username: 'prof001',
                password: 'profesor123',
                subjects: ['Matemáticas', 'Español'],
                coordinator: '3° Primaria',
                createdAt: new Date().toISOString()
            };

            // Demo event
            const demoEvent = {
                id: 'demo_event_1',
                title: 'Reunión de Padres',
                description: 'Reunión informativa sobre el progreso académico',
                date: '2024-12-20',
                time: '14:00',
                type: 'reunion',
                createdAt: new Date().toISOString()
            };

            // Demo grades
            const demoGrades = {
                'demo_student_1': {
                    'Matemáticas': {
                        attendance: 4.5,
                        notebook: 4.0,
                        work: 4.2,
                        exam: 4.3,
                        final: 4.3,
                        date: new Date().toISOString(),
                        teacher: 'Carlos Rodríguez'
                    },
                    'Español': {
                        attendance: 4.8,
                        notebook: 4.5,
                        work: 4.6,
                        exam: 4.4,
                        final: 4.6,
                        date: new Date().toISOString(),
                        teacher: 'Carlos Rodríguez'
                    }
                }
            };

            // Demo attendance
            const demoAttendance = {
                'demo_student_1_2024-12-01': 'present',
                'demo_student_1_2024-12-02': 'present',
                'demo_student_1_2024-12-03': 'late',
                'demo_student_1_2024-12-04': 'present',
                'demo_student_1_2024-12-05': 'absent'
            };

            // Check if data already exists
            const savedData = localStorage.getItem('liceoData');
            if (!savedData) {
                localCache = {
                    students: [demoStudent],
                    teachers: [demoTeacher],
                    grades: demoGrades,
                    attendance: demoAttendance,
                    events: [demoEvent],
                    ratings: []
                };
                saveToLocalStorage();
            } else {
                localCache = JSON.parse(savedData);
            }

            updateUI();
        }

        // Save to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('liceoData', JSON.stringify(localCache));
        }

        // Show loading indicator
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }

        // Hide loading indicator
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // Update UI elements
        function updateUI() {
            updateStudentSelects();
            if (document.getElementById('studentsManagement') && !document.getElementById('studentsManagement').classList.contains('hidden')) {
                displayStudents();
            }
            if (document.getElementById('teachersManagement') && !document.getElementById('teachersManagement').classList.contains('hidden')) {
                displayTeachers();
            }
            if (document.getElementById('scheduleManagement') && !document.getElementById('scheduleManagement').classList.contains('hidden')) {
                displayEvents();
            }
        }

        // Login function
        function login() {
            const userType = document.getElementById('userType').value;
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const errorDiv = document.getElementById('loginError');

            if (!username || !password) {
                showError('Por favor complete todos los campos');
                return;
            }

            let loginSuccess = false;

            if (userType === 'admin') {
                if (username === adminCredentials.username && password === adminCredentials.password) {
                    loginSuccess = true;
                    currentUser = 'Administrador';
                    showPanel('adminPanel');
                }
            } else if (userType === 'profesor') {
                const teacher = localCache.teachers.find(t => t.username === username && t.password === password);
                if (teacher) {
                    loginSuccess = true;
                    currentUser = teacher;
                    showPanel('teacherPanel');
                    updateStudentSelects();
                }
            } else if (userType === 'padre') {
                const student = localCache.students.find(s => s.document === username && s.document === password);
                if (student) {
                    loginSuccess = true;
                    currentUser = student;
                    showPanel('parentPanel');
                    displayStudentInfo(student);
                }
            }

            if (loginSuccess) {
                currentUserType = userType;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('logoutSection').classList.remove('hidden');
                errorDiv.classList.add('hidden');
            } else {
                showError('Usuario o contraseña incorrecta');
            }
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = '❌ ' + message;
            errorDiv.classList.remove('hidden');
        }

        // Show panel
        function showPanel(panelId) {
            const panels = ['adminPanel', 'teacherPanel', 'parentPanel'];
            panels.forEach(panel => {
                document.getElementById(panel).classList.add('hidden');
            });
            document.getElementById(panelId).classList.remove('hidden');
        }

        // Show section
        function showSection(sectionId) {
            const sections = [
                'studentsManagement', 'teachersManagement', 'scheduleManagement', 'reportsManagement',
                'gradesEntry', 'attendanceEntry',
                'studentGrades', 'studentAttendance', 'schoolSchedule', 'rateApp'
            ];
            
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            // Load specific data when showing sections
            if (sectionId === 'studentsManagement') {
                displayStudents();
            } else if (sectionId === 'teachersManagement') {
                displayTeachers();
            } else if (sectionId === 'scheduleManagement') {
                displayEvents();
            } else if (sectionId === 'studentGrades') {
                displayStudentGrades();
            } else if (sectionId === 'studentAttendance') {
                displayStudentAttendance();
            } else if (sectionId === 'schoolSchedule') {
                displayScheduleForParents();
            } else if (sectionId === 'rateApp') {
                displayRatings();
            }
        }

        // Add student
        function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const doc = document.getElementById('studentDoc').value.trim();
            const grade = document.getElementById('studentGrade').value;
            const parentName = document.getElementById('parentName').value.trim();
            const parentPhone = document.getElementById('parentPhone').value.trim();

            if (!name || !doc || !grade || !parentName || !parentPhone) {
                alert('❌ Por favor complete todos los campos');
                return;
            }

            // Check if student already exists
            if (localCache.students.find(s => s.document === doc)) {
                alert('❌ Ya existe un estudiante con este documento');
                return;
            }

            const student = {
                id: Date.now().toString(),
                name,
                document: doc,
                grade,
                parentName,
                parentPhone,
                createdAt: new Date().toISOString()
            };

            localCache.students.push(student);
            saveToLocalStorage();
            
            displayStudents();
            updateStudentSelects();
            
            // Clear form
            document.getElementById('studentForm').reset();
            alert('✅ Estudiante agregado exitosamente');
        }

        // Display students
        function displayStudents() {
            const container = document.getElementById('studentsList');
            container.innerHTML = '';

            localCache.students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'bg-gray-50 p-3 rounded border';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h5 class="font-semibold">${student.name}</h5>
                            <p class="text-sm text-gray-600">📄 Doc: ${student.document}</p>
                            <p class="text-sm text-gray-600">🎓 Grado: ${student.grade}</p>
                            <p class="text-sm text-gray-600">👨‍👩‍👧‍👦 Padre: ${student.parentName}</p>
                            <p class="text-sm text-gray-600">📱 Tel: ${student.parentPhone}</p>
                        </div>
                        <button onclick="deleteStudent('${student.id}')" class="text-red-500 hover:text-red-700">
                            🗑️
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Delete student
        function deleteStudent(studentId) {
            if (confirm('¿Está seguro de eliminar este estudiante?')) {
                localCache.students = localCache.students.filter(s => s.id !== studentId);
                
                // Also remove related grades and attendance
                delete localCache.grades[studentId];
                Object.keys(localCache.attendance).forEach(key => {
                    if (key.startsWith(studentId + '_')) {
                        delete localCache.attendance[key];
                    }
                });
                
                saveToLocalStorage();
                displayStudents();
                updateStudentSelects();
                alert('✅ Estudiante eliminado exitosamente');
            }
        }

        // Add teacher
        function addTeacher() {
            const name = document.getElementById('teacherName').value.trim();
            const doc = document.getElementById('teacherDoc').value.trim();
            const username = document.getElementById('teacherUser').value.trim();
            const password = document.getElementById('teacherPass').value.trim();
            const coordinator = document.getElementById('teacherCoordinator').value.trim();
            
            // Get selected subjects
            const selectedSubjects = Array.from(document.querySelectorAll('.teacher-subject:checked'))
                .map(checkbox => checkbox.value);

            if (!name || !doc || !username || !password) {
                alert('❌ Por favor complete todos los campos obligatorios (nombre, documento, usuario y contraseña)');
                return;
            }

            // Check if teacher already exists
            if (localCache.teachers.find(t => t.document === doc || t.username === username)) {
                alert('❌ Ya existe un profesor con este documento o usuario');
                return;
            }

            const teacher = {
                id: Date.now().toString(),
                name,
                document: doc,
                username,
                password,
                subjects: selectedSubjects,
                coordinator: coordinator || null,
                createdAt: new Date().toISOString()
            };

            localCache.teachers.push(teacher);
            saveToLocalStorage();
            
            displayTeachers();
            
            // Clear form
            document.getElementById('teacherForm').reset();
            // Clear checkboxes
            document.querySelectorAll('.teacher-subject').forEach(checkbox => {
                checkbox.checked = false;
            });
            alert('✅ Profesor agregado exitosamente');
        }

        // Display teachers
        function displayTeachers() {
            const container = document.getElementById('teachersList');
            container.innerHTML = '';

            localCache.teachers.forEach(teacher => {
                const div = document.createElement('div');
                div.className = 'bg-gray-50 p-3 rounded border';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h5 class="font-semibold">${teacher.name}</h5>
                            <p class="text-sm text-gray-600">📄 Doc: ${teacher.document}</p>
                            <p class="text-sm text-gray-600">👤 Usuario: ${teacher.username}</p>
                            <p class="text-sm text-gray-600">📚 Áreas: ${teacher.subjects && teacher.subjects.length > 0 ? teacher.subjects.join(', ') : 'Sin áreas asignadas'}</p>
                            ${teacher.coordinator ? `<p class="text-sm text-gray-600">👨‍🏫 Coordinador: ${teacher.coordinator}</p>` : ''}
                        </div>
                        <button onclick="deleteTeacher('${teacher.id}')" class="text-red-500 hover:text-red-700">
                            🗑️
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Delete teacher
        function deleteTeacher(teacherId) {
            if (confirm('¿Está seguro de eliminar este profesor?')) {
                localCache.teachers = localCache.teachers.filter(t => t.id !== teacherId);
                saveToLocalStorage();
                displayTeachers();
                alert('✅ Profesor eliminado exitosamente');
            }
        }

        // Add event
        function addEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const description = document.getElementById('eventDescription').value.trim();
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const type = document.getElementById('eventType').value;

            if (!title || !description || !date || !time || !type) {
                alert('❌ Por favor complete todos los campos');
                return;
            }

            const event = {
                id: Date.now().toString(),
                title,
                description,
                date,
                time,
                type,
                createdAt: new Date().toISOString()
            };

            localCache.events.push(event);
            saveToLocalStorage();
            
            displayEvents();
            
            // Clear form
            document.getElementById('eventForm').reset();
            alert('✅ Evento agregado exitosamente');
        }

        // Display events
        function displayEvents() {
            const container = document.getElementById('eventsList');
            if (!container) return;

            container.innerHTML = '';

            // Sort events by date
            const sortedEvents = localCache.events.sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));

            sortedEvents.forEach(event => {
                const eventDate = new Date(event.date + ' ' + event.time);
                const isUpcoming = eventDate >= new Date();
                
                const div = document.createElement('div');
                div.className = `p-3 rounded border ${isUpcoming ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`;
                
                const typeEmojis = {
                    'reunion': '🤝',
                    'actividad': '🎉',
                    'evaluacion': '📝',
                    'evento': '🎊'
                };

                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h5 class="font-semibold">${typeEmojis[event.type]} ${event.title}</h5>
                            <p class="text-sm text-gray-600">${event.description}</p>
                            <p class="text-sm text-gray-600">📅 ${event.date} ⏰ ${event.time}</p>
                            ${isUpcoming ? '<span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded">Próximo</span>' : '<span class="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded">Pasado</span>'}
                        </div>
                        ${currentUserType === 'admin' ? `<button onclick="deleteEvent('${event.id}')" class="text-red-500 hover:text-red-700">🗑️</button>` : ''}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Delete event
        function deleteEvent(eventId) {
            if (confirm('¿Está seguro de eliminar este evento?')) {
                localCache.events = localCache.events.filter(e => e.id !== eventId);
                saveToLocalStorage();
                displayEvents();
                alert('✅ Evento eliminado exitosamente');
            }
        }

        // Update student selects
        function updateStudentSelects() {
            const selects = ['gradeStudent'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Seleccionar estudiante</option>';
                    localCache.students.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student.id;
                        option.textContent = `${student.name} - ${student.grade}`;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Save grades
        function saveGrades() {
            const studentId = document.getElementById('gradeStudent').value;
            const subject = document.getElementById('gradeSubject').value;
            const attendance = parseFloat(document.getElementById('attendanceGrade').value);
            const notebook = parseFloat(document.getElementById('notebookGrade').value);
            const work = parseFloat(document.getElementById('workGrade').value);
            const exam = parseFloat(document.getElementById('examGrade').value);

            if (!studentId || !subject || isNaN(attendance) || isNaN(notebook) || isNaN(work) || isNaN(exam)) {
                alert('❌ Por favor complete todos los campos con valores válidos');
                return;
            }

            // Calculate final grade
            const finalGrade = (attendance * 0.3) + (notebook * 0.2) + (work * 0.25) + (exam * 0.25);

            if (!localCache.grades[studentId]) {
                localCache.grades[studentId] = {};
            }

            localCache.grades[studentId][subject] = {
                attendance,
                notebook,
                work,
                exam,
                final: Math.round(finalGrade * 10) / 10,
                date: new Date().toISOString(),
                teacher: currentUser.name
            };

            saveToLocalStorage();
            
            // Update final grade display
            document.getElementById('finalGrade').textContent = `Nota Final: ${Math.round(finalGrade * 10) / 10}`;
            
            // Clear form
            document.getElementById('gradeStudent').value = '';
            document.getElementById('gradeSubject').value = '';
            document.getElementById('attendanceGrade').value = '';
            document.getElementById('notebookGrade').value = '';
            document.getElementById('workGrade').value = '';
            document.getElementById('examGrade').value = '';
            
            alert('✅ Notas guardadas exitosamente');
        }

        // Calculate grade in real time
        function calculateGrade() {
            const attendance = parseFloat(document.getElementById('attendanceGrade').value) || 0;
            const notebook = parseFloat(document.getElementById('notebookGrade').value) || 0;
            const work = parseFloat(document.getElementById('workGrade').value) || 0;
            const exam = parseFloat(document.getElementById('examGrade').value) || 0;

            const finalGrade = (attendance * 0.3) + (notebook * 0.2) + (work * 0.25) + (exam * 0.25);
            document.getElementById('finalGrade').textContent = `Nota Final: ${Math.round(finalGrade * 10) / 10}`;
        }

        // Load attendance list
        function loadAttendanceList() {
            const date = document.getElementById('attendanceDate').value;
            if (!date) {
                alert('❌ Por favor seleccione una fecha');
                return;
            }

            const container = document.getElementById('attendanceList');
            container.innerHTML = '';

            localCache.students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between bg-gray-50 p-3 rounded';
                
                const attendanceKey = `${student.id}_${date}`;
                const currentAttendance = localCache.attendance[attendanceKey] || 'present';

                div.innerHTML = `
                    <span class="font-medium">${student.name} - ${student.grade}</span>
                    <div class="flex gap-2">
                        <label class="flex items-center">
                            <input type="radio" name="attendance_${student.id}" value="present" ${currentAttendance === 'present' ? 'checked' : ''} class="mr-1">
                            ✅ Presente
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="attendance_${student.id}" value="absent" ${currentAttendance === 'absent' ? 'checked' : ''} class="mr-1">
                            ❌ Ausente
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="attendance_${student.id}" value="late" ${currentAttendance === 'late' ? 'checked' : ''} class="mr-1">
                            ⏰ Tarde
                        </label>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Save attendance
        function saveAttendance() {
            const date = document.getElementById('attendanceDate').value;
            if (!date) {
                alert('❌ Por favor seleccione una fecha');
                return;
            }

            localCache.students.forEach(student => {
                const radioButtons = document.getElementsByName(`attendance_${student.id}`);
                const selectedValue = Array.from(radioButtons).find(radio => radio.checked)?.value || 'present';
                
                const attendanceKey = `${student.id}_${date}`;
                localCache.attendance[attendanceKey] = selectedValue;
            });

            saveToLocalStorage();
            alert('✅ Asistencia guardada exitosamente');
        }

        // Display student info for parents
        function displayStudentInfo(student) {
            const container = document.getElementById('studentInfo');
            container.innerHTML = `
                <div class="bg-gradient-to-r from-azul-institucional to-blue-600 text-white p-6 rounded-lg">
                    <h3 class="text-2xl font-bold mb-2">👨‍🎓 ${student.name}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p><strong>📄 Documento:</strong> ${student.document}</p>
                            <p><strong>🎓 Grado:</strong> ${student.grade}</p>
                        </div>
                        <div>
                            <p><strong>👨‍👩‍👧‍👦 Padre/Madre:</strong> ${student.parentName}</p>
                            <p><strong>📱 Teléfono:</strong> ${student.parentPhone}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Display student grades for parents
        function displayStudentGrades() {
            const container = document.getElementById('gradesDisplay');
            const studentGrades = localCache.grades[currentUser.id] || {};
            
            if (Object.keys(studentGrades).length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">📝 Aún no hay notas registradas</p>';
                return;
            }

            let html = '<div class="space-y-4">';
            
            Object.entries(studentGrades).forEach(([subject, grades]) => {
                html += `
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold text-azul-institucional mb-3">📚 ${subject}</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-3">
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Asistencia (30%)</p>
                                <p class="font-bold text-lg">${grades.attendance}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Cuaderno (20%)</p>
                                <p class="font-bold text-lg">${grades.notebook}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Trabajo (25%)</p>
                                <p class="font-bold text-lg">${grades.work}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Evaluación (25%)</p>
                                <p class="font-bold text-lg">${grades.exam}</p>
                            </div>
                        </div>
                        <div class="text-center bg-azul-institucional text-white p-3 rounded">
                            <p class="font-bold text-xl">Nota Final: ${grades.final}</p>
                            <p class="text-sm">Profesor: ${grades.teacher}</p>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Display student attendance for parents
        function displayStudentAttendance() {
            const container = document.getElementById('attendanceDisplay');
            const studentId = currentUser.id;
            
            // Get all attendance records for this student
            const attendanceRecords = Object.entries(localCache.attendance)
                .filter(([key, value]) => key.startsWith(studentId + '_'))
                .map(([key, value]) => ({
                    date: key.split('_')[1],
                    status: value
                }))
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            if (attendanceRecords.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">📅 Aún no hay registros de asistencia</p>';
                return;
            }

            // Calculate statistics
            const total = attendanceRecords.length;
            const present = attendanceRecords.filter(r => r.status === 'present').length;
            const absent = attendanceRecords.filter(r => r.status === 'absent').length;
            const late = attendanceRecords.filter(r => r.status === 'late').length;
            const attendancePercentage = Math.round((present / total) * 100);

            let html = `
                <div class="mb-6">
                    <h4 class="font-bold text-azul-institucional mb-3">📊 Resumen de Asistencia</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div class="bg-green-100 p-3 rounded text-center">
                            <p class="text-2xl font-bold text-green-600">${present}</p>
                            <p class="text-sm">✅ Presente</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded text-center">
                            <p class="text-2xl font-bold text-red-600">${absent}</p>
                            <p class="text-sm">❌ Ausente</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded text-center">
                            <p class="text-2xl font-bold text-yellow-600">${late}</p>
                            <p class="text-sm">⏰ Tarde</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded text-center">
                            <p class="text-2xl font-bold text-blue-600">${attendancePercentage}%</p>
                            <p class="text-sm">📈 Asistencia</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-bold text-azul-institucional mb-3">📅 Historial Detallado</h4>
                    <div class="space-y-2 max-h-64 overflow-y-auto">
            `;

            attendanceRecords.forEach(record => {
                const statusEmoji = {
                    'present': '✅',
                    'absent': '❌',
                    'late': '⏰'
                };
                
                const statusText = {
                    'present': 'Presente',
                    'absent': 'Ausente',
                    'late': 'Llegó tarde'
                };

                const statusColor = {
                    'present': 'bg-green-50 border-green-200',
                    'absent': 'bg-red-50 border-red-200',
                    'late': 'bg-yellow-50 border-yellow-200'
                };

                html += `
                    <div class="flex justify-between items-center p-3 rounded border ${statusColor[record.status]}">
                        <span>${record.date}</span>
                        <span class="font-medium">${statusEmoji[record.status]} ${statusText[record.status]}</span>
                    </div>
                `;
            });

            html += '</div></div>';
            container.innerHTML = html;
        }

        // Display schedule for parents
        function displayScheduleForParents() {
            const container = document.getElementById('scheduleDisplay');
            displayEvents();
            
            // Copy events to parent schedule display
            const eventsList = document.getElementById('eventsList');
            if (eventsList) {
                container.innerHTML = eventsList.innerHTML;
            }
        }

        // Rating functions
        function setRating(rating) {
            selectedRating = rating;
            
            // Update star display
            for (let i = 1; i <= 5; i++) {
                const star = document.getElementById(`star${i}`);
                if (i <= rating) {
                    star.textContent = '⭐';
                    star.style.filter = 'brightness(1.2)';
                } else {
                    star.textContent = '☆';
                    star.style.filter = 'brightness(0.7)';
                }
            }
        }

        function submitRating() {
            if (selectedRating === 0) {
                alert('❌ Por favor seleccione una calificación');
                return;
            }

            const comment = document.getElementById('ratingComment').value.trim();
            
            const rating = {
                id: Date.now().toString(),
                rating: selectedRating,
                comment: comment || 'Sin comentarios',
                user: currentUser.name,
                date: new Date().toISOString()
            };

            localCache.ratings.push(rating);
            saveToLocalStorage();
            
            displayRatings();
            
            // Reset form
            selectedRating = 0;
            document.getElementById('ratingComment').value = '';
            setRating(0);
            
            alert('✅ ¡Gracias por tu calificación!');
        }

        function displayRatings() {
            const container = document.getElementById('ratingsList');
            if (!container) return;

            if (localCache.ratings.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">⭐ Aún no hay calificaciones</p>';
                return;
            }

            // Calculate average rating
            const avgRating = localCache.ratings.reduce((sum, r) => sum + r.rating, 0) / localCache.ratings.length;
            
            let html = `
                <div class="bg-azul-institucional text-white p-4 rounded-lg mb-4 text-center">
                    <h5 class="font-bold text-lg">Calificación Promedio</h5>
                    <div class="text-3xl font-bold">${Math.round(avgRating * 10) / 10} ⭐</div>
                    <p class="text-sm">${localCache.ratings.length} calificaciones</p>
                </div>
                <div class="space-y-3 max-h-64 overflow-y-auto">
            `;

            // Show recent ratings
            const recentRatings = localCache.ratings.slice(-10).reverse();
            
            recentRatings.forEach(rating => {
                const stars = '⭐'.repeat(rating.rating) + '☆'.repeat(5 - rating.rating);
                const date = new Date(rating.date).toLocaleDateString();
                
                html += `
                    <div class="bg-gray-50 p-3 rounded border">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-medium">${rating.user}</span>
                            <span class="text-sm text-gray-500">${date}</span>
                        </div>
                        <div class="text-lg mb-2">${stars}</div>
                        <p class="text-sm text-gray-700">${rating.comment}</p>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // Export data function
        function exportData() {
            const dataStr = JSON.stringify(localCache, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `liceo_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            alert('✅ Datos exportados exitosamente');
        }

        // Search student reports
        function searchStudentReports() {
            const searchTerm = document.getElementById('searchStudent').value.trim().toLowerCase();
            if (!searchTerm) {
                alert('❌ Por favor ingrese un término de búsqueda');
                return;
            }

            const student = localCache.students.find(s => 
                s.name.toLowerCase().includes(searchTerm) || 
                s.document.includes(searchTerm)
            );

            if (!student) {
                document.getElementById('reportResults').innerHTML = '<p class="text-red-500">❌ Estudiante no encontrado</p>';
                return;
            }

            // Generate student report
            const grades = localCache.grades[student.id] || {};
            const attendanceRecords = Object.entries(localCache.attendance)
                .filter(([key, value]) => key.startsWith(student.id + '_'));

            let html = `
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-xl font-bold text-azul-institucional mb-4">📊 Reporte de ${student.name}</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="font-semibold mb-3">📚 Notas por Área</h5>
                            ${Object.keys(grades).length > 0 ? 
                                Object.entries(grades).map(([subject, grade]) => `
                                    <div class="mb-2 p-2 bg-gray-50 rounded">
                                        <strong>${subject}:</strong> ${grade.final}
                                    </div>
                                `).join('') : 
                                '<p class="text-gray-500">Sin notas registradas</p>'
                            }
                        </div>
                        
                        <div>
                            <h5 class="font-semibold mb-3">📅 Resumen de Asistencia</h5>
                            ${attendanceRecords.length > 0 ? `
                                <div class="space-y-2">
                                    <p>Total días: ${attendanceRecords.length}</p>
                                    <p>Presente: ${attendanceRecords.filter(([k,v]) => v === 'present').length}</p>
                                    <p>Ausente: ${attendanceRecords.filter(([k,v]) => v === 'absent').length}</p>
                                    <p>Tarde: ${attendanceRecords.filter(([k,v]) => v === 'late').length}</p>
                                </div>
                            ` : '<p class="text-gray-500">Sin registros de asistencia</p>'}
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('reportResults').innerHTML = html;
        }

        // Generate general report
        function generateGeneralReport() {
            const totalStudents = localCache.students.length;
            const totalTeachers = localCache.teachers.length;
            const totalGrades = Object.keys(localCache.grades).length;
            const totalEvents = localCache.events.length;

            // Calculate grade distribution
            const allGrades = [];
            Object.values(localCache.grades).forEach(studentGrades => {
                Object.values(studentGrades).forEach(grade => {
                    allGrades.push(grade.final);
                });
            });

            const avgGrade = allGrades.length > 0 ? 
                Math.round((allGrades.reduce((sum, grade) => sum + grade, 0) / allGrades.length) * 10) / 10 : 0;

            const html = `
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-xl font-bold text-azul-institucional mb-4">📊 Reporte General del Liceo</h4>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-100 p-4 rounded text-center">
                            <div class="text-2xl font-bold text-blue-600">${totalStudents}</div>
                            <div class="text-sm">👨‍🎓 Estudiantes</div>
                        </div>
                        <div class="bg-green-100 p-4 rounded text-center">
                            <div class="text-2xl font-bold text-green-600">${totalTeachers}</div>
                            <div class="text-sm">👨‍🏫 Profesores</div>
                        </div>
                        <div class="bg-yellow-100 p-4 rounded text-center">
                            <div class="text-2xl font-bold text-yellow-600">${totalEvents}</div>
                            <div class="text-sm">📅 Eventos</div>
                        </div>
                        <div class="bg-purple-100 p-4 rounded text-center">
                            <div class="text-2xl font-bold text-purple-600">${avgGrade}</div>
                            <div class="text-sm">📊 Promedio</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="font-semibold mb-3">👨‍🎓 Estudiantes por Grado</h5>
                            ${Object.entries(
                                localCache.students.reduce((acc, student) => {
                                    acc[student.grade] = (acc[student.grade] || 0) + 1;
                                    return acc;
                                }, {})
                            ).map(([grade, count]) => `
                                <div class="flex justify-between p-2 bg-gray-50 rounded mb-1">
                                    <span>${grade}</span>
                                    <span class="font-bold">${count}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div>
                            <h5 class="font-semibold mb-3">👨‍🏫 Profesores por Área</h5>
                            ${Object.entries(
                                localCache.teachers.reduce((acc, teacher) => {
                                    if (teacher.subjects && teacher.subjects.length > 0) {
                                        teacher.subjects.forEach(subject => {
                                            acc[subject] = (acc[subject] || 0) + 1;
                                        });
                                    } else {
                                        acc['Sin área asignada'] = (acc['Sin área asignada'] || 0) + 1;
                                    }
                                    return acc;
                                }, {})
                            ).map(([subject, count]) => `
                                <div class="flex justify-between p-2 bg-gray-50 rounded mb-1">
                                    <span>${subject}</span>
                                    <span class="font-bold">${count}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('reportResults').innerHTML = html;
        }

        // Generate attendance report
        function generateAttendanceReport() {
            const attendanceStats = {};
            
            // Calculate attendance statistics
            Object.entries(localCache.attendance).forEach(([key, status]) => {
                const [studentId, date] = key.split('_');
                const student = localCache.students.find(s => s.id == studentId);
                
                if (student) {
                    if (!attendanceStats[student.name]) {
                        attendanceStats[student.name] = { present: 0, absent: 0, late: 0, total: 0 };
                    }
                    
                    attendanceStats[student.name][status]++;
                    attendanceStats[student.name].total++;
                }
            });

            let html = `
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-xl font-bold text-azul-institucional mb-4">📅 Reporte de Asistencia</h4>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300">
                            <thead>
                                <tr class="bg-azul-institucional text-white">
                                    <th class="border border-gray-300 p-2">Estudiante</th>
                                    <th class="border border-gray-300 p-2">Presente</th>
                                    <th class="border border-gray-300 p-2">Ausente</th>
                                    <th class="border border-gray-300 p-2">Tarde</th>
                                    <th class="border border-gray-300 p-2">Total</th>
                                    <th class="border border-gray-300 p-2">% Asistencia</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            Object.entries(attendanceStats).forEach(([studentName, stats]) => {
                const percentage = stats.total > 0 ? Math.round((stats.present / stats.total) * 100) : 0;
                const rowColor = percentage >= 90 ? 'bg-green-50' : percentage >= 80 ? 'bg-yellow-50' : 'bg-red-50';
                
                html += `
                    <tr class="${rowColor}">
                        <td class="border border-gray-300 p-2 font-medium">${studentName}</td>
                        <td class="border border-gray-300 p-2 text-center">${stats.present}</td>
                        <td class="border border-gray-300 p-2 text-center">${stats.absent}</td>
                        <td class="border border-gray-300 p-2 text-center">${stats.late}</td>
                        <td class="border border-gray-300 p-2 text-center font-bold">${stats.total}</td>
                        <td class="border border-gray-300 p-2 text-center font-bold">${percentage}%</td>
                    </tr>
                `;
            });

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            document.getElementById('reportResults').innerHTML = html;
        }

        // Logout function
        function logout() {
            currentUser = null;
            currentUserType = null;
            
            // Hide all panels
            const panels = ['adminPanel', 'teacherPanel', 'parentPanel'];
            panels.forEach(panel => {
                document.getElementById(panel).classList.add('hidden');
            });
            
            // Show login section
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('logoutSection').classList.add('hidden');
            
            // Clear login form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('userType').value = 'padre';
            document.getElementById('loginError').classList.add('hidden');
        }

        // Add event listeners for real-time calculation
        document.addEventListener('DOMContentLoaded', function() {
            const gradeInputs = ['attendanceGrade', 'notebookGrade', 'workGrade', 'examGrade'];
            gradeInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', calculateGrade);
                }
            });

            // Initialize the application
            showLoading();
            setTimeout(() => {
                initializeDemoData();
                hideLoading();
            }, 1000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97bf5413c02731e0',t:'MTc1NzM0Mzc2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

